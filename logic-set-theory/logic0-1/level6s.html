<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Logic 0 ‚Äì Level 6s</title>

  <!-- Basic layout styles -->
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
                   sans-serif;
      line-height: 1.5;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }

    header {
      background: #222;
      color: #fff;
      padding: 1rem 1.5rem;
    }

    header h1 {
      margin: 0;
      font-size: 1.6rem;
    }

    main {
      max-width: 900px;
      margin: 1.5rem auto 3rem;
      padding: 0 1rem 2rem;
      background: #fff;
      box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.08);
      border-radius: 8px;
    }

    section {
      margin-bottom: 2rem;
    }

    h2 {
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
      font-size: 1.3rem;
    }

    h3 {
      margin-top: 1rem;
      margin-bottom: 0.4rem;
      font-size: 1.1rem;
    }

    .note {
      font-size: 0.9rem;
      color: #555;
      margin-bottom: 0.8rem;
    }

    .problem-group {
      border-top: 1px solid #eee;
      padding-top: 1.25rem;
      margin-top: 1.25rem;
    }

    .problem-group:first-of-type {
      border-top: none;
      padding-top: 0;
      margin-top: 0.5rem;
    }

    .latex-input {
      width: 100%;
      min-height: 70px;
      padding: 0.5rem;
      font-family: "Fira Code", "JetBrains Mono", Menlo, Monaco,
                   Consolas, "Courier New", monospace;
      font-size: 0.95rem;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      resize: vertical;
      margin-bottom: 0.5rem;
    }

    .rendered-output {
      min-height: 2rem;
      padding: 0.5rem;
      border-radius: 4px;
      border: 1px dashed #ccc;
      background: #fafafa;
      margin-bottom: 0.5rem;
      text-align: center;
    }

    .rendered-output mjx-container {
      display: inline-block;
      margin-left: auto;
      margin-right: auto;
    }

    .controls {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-bottom: 0.3rem;
    }

    .copy-btn {
      padding: 0.3rem 0.7rem;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      background: #333;
      color: #fff;
      font-size: 0.9rem;
    }

    .copy-btn:active {
      transform: scale(0.97);
    }

    .copy-btn.copied::after {
      content: " ‚úì";
    }

    .canvas-wrapper {
      border: 1px solid #ccc;
      border-radius: 4px;
      overflow: hidden;
      background: #fff;
    }

    .canvas-block {
      margin-top: 0.75rem;
    }

    .note-canvas {
      display: block;
      width: 100%;
      height: 250px;
      touch-action: none; /* for better touch drawing */
    }

    .clear-canvas {
      margin-top: 0.4rem;
    }



  </style>

  <!-- MathJax for LaTeX rendering -->
  <script>
    window.MathJax = {
      tex: {
        packages: { "[+]": ["ams"] },
        inlineMath: [["\\(","\\)"], ["$","$"]],
        displayMath: [["\\[","\\]"], ["$$","$$"]]
      },
      svg: { fontCache: "global" }
    };
  </script>

  <script id="MathJax-script"
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"
          async></script>
</head>
<body>
  <header>
    <h1>Logic 0 ‚Äì Level 6s Problems</h1>
  </header>

<main>
  <section>
    <p class="note">
      This page is a vertically-layered problem bank built from <code>0logic.pdf</code>.
      Within each topic, problems are roughly ordered from [1] (simpler, ‚Äúpure type‚Äù) up to [5]
      (fusion / creative). Use the note + canvas under each topic to work through ideas.
    </p>
  </section>

  <!-- 1. Set Equality & Extensionality -->
  <section class="problem-group" id="group-1">
    <h2>1. Set Equality &amp; Extensionality</h2>
    <p><em>Core idea</em>: Two sets are equal iff they have exactly the same elements (extensionality).</p>

    <h3>[1] Pure type (mechanical)</h3>
    <p><strong>(E1.1)</strong><br>
      Decide whether each pair of sets is equal. If equal, justify with a one-line explanation.
      If not, name one element that witnesses the difference.
    </p>
    <ol>
      <li>\(A = \{0,1,2\}\), \(B = \{2,1,0\}\)</li>
      <li>\(C = \{n\in\mathbb{Z}\mid -2\le n\le 2\}\), \(D = \{-2,-1,0,1,2\}\)</li>
      <li>\(E = \{2n\mid n\in\mathbb{Z}\}\), \(F = \{m\in\mathbb{Z}\mid m\text{ is even}\}\)</li>
      <li>\(G = \{1,2,3\}\), \(H = \{1,2,\{3\}\}\)</li>
    </ol>

    <h3>[2] Variation (same idea, slightly hidden)</h3>
    <p><strong>(E1.2)</strong><br>
      Each line gives two <em>descriptions</em>. For each pair, say whether they define the same set
      or different sets. Justify using extensionality (‚Äúfor all \(t\), \(t\in A\iff t\in B\)‚Äù).
    </p>
    <ol>
      <li>
        <ul>
          <li>\(A = \{n\in\mathbb{Z}\mid n^2 &lt; 9\}\)</li>
          <li>\(B = \{-2,-1,0,1,2\}\)</li>
        </ul>
      </li>
      <li>
        <ul>
          <li>\(C = \{x\in\mathbb{R}\mid x^2 = 1\}\)</li>
          <li>\(D = \{-1,1\}\)</li>
          <li>\(E = \{x\in\mathbb{R}\mid (x-1)(x+1)=0\}\)</li>
        </ul>
      </li>
      <li>
        <ul>
          <li>\(F = \{x\in\mathbb{R}\mid x^2 + 1 = 0\}\)</li>
          <li>\(G = \varnothing\)</li>
        </ul>
      </li>
    </ol>

    <h3>[3] Fusion (extensionality + set-builder + power set)</h3>
    <p><strong>(E1.3)</strong><br>
      Let
      \[
      A = \{0,\{0\}\},\qquad B = \{\varnothing,\{\varnothing\}\}.
      \]
    </p>
    <ol>
      <li>List all elements of \(\mathcal{P}(A)\) and \(\mathcal{P}(B)\).</li>
      <li>Decide whether \(\mathcal{P}(A) = \mathcal{P}(B)\). Use extensionality on the <strong>power sets</strong>, not on \(A,B\) themselves.</li>
      <li>
        Explain carefully the difference between ‚Äú\(0\)‚Äù and ‚Äú\(\varnothing\)‚Äù in this context,
        and why confusing them would sabotage the argument.
      </li>
    </ol>
    <p class="note"><em>Trap:</em> mixing up element vs empty set, and confusing \(A\) with \(\mathcal{P}(A)\).</p>

    <h3>[4] Hidden structure (equality via a chain of equivalences)</h3>
    <p><strong>(E1.4)</strong><br>
      Let
      \[
      S = \{n\in\mathbb{Z}\mid n\text{ has an odd number of positive divisors}\},\qquad
      T = \{m^2 \mid m\in\mathbb{Z}\}.
      \]
    </p>
    <ol>
      <li>Compute all elements of \(S\) with \(|n|\le 10\).</li>
      <li>Compute all elements of \(T\) with \(|m|\le 10\).</li>
      <li>Conjecture whether \(S = T\).</li>
      <li>
        Outline a proof strategy based on the extensionality principle
        (‚Äúto show \(S=T\), we must show‚Ä¶‚Äù), without filling in every detail.
      </li>
    </ol>

    <h3>[5] Creative (design your own equivalent descriptions)</h3>
    <p><strong>(E1.5)</strong><br>
      Create <strong>two different</strong> set-builder descriptions \(A,B\subseteq\mathbb{Z}\) such that
      \(A=B\) but the descriptions look quite different.
    </p>
    <ol>
      <li>Write \(A\) and \(B\) in set-builder notation.</li>
      <li>
        Prove that \(A=B\) using extensionality, explicitly showing:
        \[
        \forall t,\ (t\in A\Rightarrow t\in B)\quad\text{and}\quad
        \forall t,\ (t\in B\Rightarrow t\in A).
        \]
      </li>
      <li>
        Explain in a short paragraph why <em>extensionality</em> is what lets us say the sets are
        ‚Äúreally the same‚Äù even though the descriptions look unrelated.
      </li>
    </ol>

    <!-- Notes + drawing -->
    <div class="group-notes">
      <h3>Notes for Group 1</h3>
      <div class="note">Type \\ quickly to open the LaTeX snippet app on this note.</div>
      <textarea class="latex-input"
        placeholder="Work through E1.1‚ÄìE1.5: explicit membership checks, power-set extensionality, and your own equal set descriptions."></textarea>
      <div class="rendered-output"></div>
      <div class="controls">
        <button class="copy-btn">Copy problems + notes</button>
      </div>
    </div>
    <div class="canvas-block">
      <div class="note">Use the canvas to sketch membership diagrams and chains of equivalences.</div>
      <div class="canvas-wrapper">
        <canvas class="note-canvas"></canvas>
      </div>
      <button class="copy-btn clear-canvas">Clear drawing</button>
    </div>
  </section>

  <!-- 2. Subsets & Power Sets -->
  <section class="problem-group" id="group-2">
    <h2>2. Subsets &amp; Power Sets</h2>
    <p><em>Core ideas</em>: \(A\subseteq B\) iff \(\forall x(x\in A\Rightarrow x\in B)\); \(\mathcal{P}(A)\) = all subsets of \(A\).</p>

    <h3>[1] Pure type</h3>
    <p><strong>(S2.1)</strong><br>
      Let \(X = \{0,1,2\}\). For each statement, say whether it is true or false. Briefly justify.
    </p>
    <ol>
      <li>\(\{0,2\}\subseteq X\)</li>
      <li>\(\{0,3\}\subseteq X\)</li>
      <li>\(\varnothing\subseteq X\)</li>
      <li>\(X\subseteq X\)</li>
      <li>\(\{0\}\in \mathcal{P}(X)\)</li>
      <li>\(\{0\}\subseteq\mathcal{P}(X)\)</li>
    </ol>
    <p class="note"><em>Trap:</em> mixing ‚Äú\(\in\)‚Äù and ‚Äú\(\subseteq\)‚Äù.</p>

    <h3>[2] Variation (power set structure)</h3>
    <p><strong>(S2.2)</strong><br>
      Let \(A=\{a,b\}\), \(B=\{\varnothing\}\), \(C=\{\varnothing,\{a\}\}\).
    </p>
    <ol>
      <li>List all elements of \(\mathcal{P}(A)\), \(\mathcal{P}(B)\), \(\mathcal{P}(C)\).</li>
      <li>Among the three power sets, decide which subsets (if any) are equal.</li>
      <li>
        Determine whether each of the following is true or false:
        <ul>
          <li>\(\mathcal{P}(B)\subseteq \mathcal{P}(C)\)</li>
          <li>\(B\subseteq \mathcal{P}(C)\)</li>
          <li>\(\mathcal{P}(B)\subseteq C\)</li>
        </ul>
        Explain each answer with the formal definition of ‚Äúsubset‚Äù.
      </li>
    </ol>

    <h3>[3] Fusion (subset + power set + extensionality)</h3>
    <p><strong>(S2.3)</strong><br>
      A student claims:
    </p>
    <blockquote>
      If \(\mathcal{P}(A) = \mathcal{P}(B)\), then \(A=B\).
    </blockquote>
    <ol>
      <li>Either prove the claim rigorously <strong>or</strong> construct a counterexample.</li>
      <li>
        In your argument, make explicit use of:
        <ul>
          <li>the definition of power set,</li>
          <li>the subset definition,</li>
          <li>extensionality for sets.</li>
        </ul>
      </li>
      <li>
        Explain why getting this right is important when we later talk about things like \(\mathbb{R}\)
        vs \(\mathcal{P}(\mathbb{N})\).
      </li>
    </ol>

    <h3>[4] Hidden structure (families of subsets)</h3>
    <p><strong>(S2.4)</strong><br>
      Let \(X = \{1,2,3,4\}\) and consider the family
      \[
      \mathcal{F} = \{\{1,2\},\{2,3\},\{3,4\}\}.
      \]
    </p>
    <ol>
      <li>Compute \(\bigcup\mathcal{F}\) and \(\bigcap\mathcal{F}\).</li>
      <li>
        Now define
        \[
        \mathcal{G} = \{F\subseteq X \mid F\subseteq \{2,3\}\}.
        \]
        List all elements of \(\mathcal{G}\).
      </li>
      <li>Compare \(\mathcal{G}\) with \(\mathcal{P}(\{2,3\})\). Are they equal? Why?</li>
      <li>
        Explain the relationship between ‚Äú\(\mathcal{G}\subseteq \mathcal{P}(X)\)‚Äù and
        ‚Äú\(\forall F\in\mathcal{G}, F\subseteq X\)‚Äù.
      </li>
    </ol>

    <h3>[5] Creative (design a family with target properties)</h3>
    <p><strong>(S2.5)</strong><br>
      Construct a family \(\mathcal{H}\) of subsets of \(\{1,2,3,4,5\}\) such that:
    </p>
    <ol>
      <li>No two distinct sets in \(\mathcal{H}\) are comparable by \(\subseteq\) (i.e., it is an antichain).</li>
      <li>Every element of \(\{1,2,3,4,5\}\) appears in <strong>at least two</strong> different sets of \(\mathcal{H}\).</li>
      <li>\(\bigcup\mathcal{H} = \{1,2,3,4,5\}\).</li>
      <li>Prove that your family satisfies all three properties.</li>
      <li>
        Explain (in a short paragraph) how thinking in terms of subsets and power sets helps design such a
        ‚Äúbalanced‚Äù family.
      </li>
    </ol>

    <!-- Notes + drawing -->
    <div class="group-notes">
      <h3>Notes for Group 2</h3>
      <div class="note">Type \\ quickly to open the LaTeX snippet app on this note.</div>
      <textarea class="latex-input"
        placeholder="Track subset vs element, list power sets, and design the antichain family ‚Ñã on {1,‚Ä¶,5}."></textarea>
      <div class="rendered-output"></div>
      <div class="controls">
        <button class="copy-btn">Copy problems + notes</button>
      </div>
    </div>
    <div class="canvas-block">
      <div class="note">Use the canvas to draw Hasse diagrams for subsets and families.</div>
      <div class="canvas-wrapper">
        <canvas class="note-canvas"></canvas>
      </div>
      <button class="copy-btn clear-canvas">Clear drawing</button>
    </div>
  </section>

  <!-- 3. Unions & Intersections -->
  <section class="problem-group" id="group-3">
    <h2>3. Unions &amp; Intersections (Including Families)</h2>
    <p><em>Core ideas</em>: Definitions of \(A\cup B\), \(A\cap B\); disjointness; union/intersection over families.</p>

    <h3>[1] Pure type</h3>
    <p><strong>(U3.1)</strong><br>
      Let \(A=\{0,1,2\}\), \(B=\{2,3,4\}\), \(C=\{4,5\}\).
    </p>
    <ol>
      <li>Compute \(A\cup B\), \(A\cap B\).</li>
      <li>Compute \((A\cup B)\cup C\) and \(A\cup (B\cup C)\). Are they equal?</li>
      <li>Compute \((A\cap B)\cap C\) and \(A\cap (B\cap C)\). Are they equal?</li>
      <li>Use these to guess the associativity laws for union and intersection.</li>
    </ol>

    <h3>[2] Variation (families &amp; pairwise disjoint)</h3>
    <p><strong>(U3.2)</strong><br>
      Let
      \[
      \mathcal{A} = \{\{0,1\},\{2,3\},\{4,5\}\},\quad
      \mathcal{B} = \{\{0,1,2\},\{2,3,4\},\{4,5,6\}\}.
      \]
    </p>
    <ol>
      <li>Are the sets in \(\mathcal{A}\) pairwise disjoint? Are the sets in \(\mathcal{B}\) pairwise disjoint?</li>
      <li>Compute \(\bigcup\mathcal{A}\), \(\bigcup\mathcal{B}\).</li>
      <li>Compute \(\bigcap\mathcal{A}\), \(\bigcap\mathcal{B}\).</li>
      <li>Explain how pairwise disjointness affects (or doesn‚Äôt affect) the intersection.</li>
    </ol>

    <h3>[3] Fusion (infinite families, ‚Äútails‚Äù &amp; ‚Äúinitial segments‚Äù)</h3>
    <p><strong>(U3.3)</strong><br>
      Define, for each \(n\in\mathbb{N}\):
    </p>
    <ul>
      <li>\(T_n = \{n,n+1,n+2,\dots\}\) (tail),</li>
      <li>\(I_n = \{0,1,\dots,n\}\) (initial segment).</li>
    </ul>
    <ol>
      <li>Decide whether \((T_n)\) is increasing or decreasing under \(\subseteq\). Same for \((I_n)\).</li>
      <li>Find \(\bigcup_{n\in\mathbb{N}} T_n\) and \(\bigcap_{n\in\mathbb{N}} T_n\).</li>
      <li>Find \(\bigcup_{n\in\mathbb{N}} I_n\) and \(\bigcap_{n\in\mathbb{N}} I_n\).</li>
      <li>
        Explain the ‚Äúopposite behavior‚Äù between tails and initial segments in terms of union vs intersection.
      </li>
    </ol>

    <h3>[4] Hidden structure (trap on swapped definitions)</h3>
    <p><strong>(U3.4)</strong><br>
      Suppose someone mistakenly defines:
      \[
      A\cup' B = \{x\mid x\in A\text{ and }x\in B\},\quad
      A\cap' B = \{x\mid x\in A\text{ or }x\in B\}.
      \]
    </p>
    <ol>
      <li>For \(A=\{0,1\}\), \(B=\{1,2\}\), compute \(A\cup' B\) and \(A\cap' B\).</li>
      <li>Compare your answers to the true \(A\cup B\) and \(A\cap B\).</li>
      <li>
        Construct a word problem or small scenario where using \(\cup'\) and \(\cap'\) instead of \(\cup,\cap\)
        would give a wildly wrong interpretation.
      </li>
      <li>
        Explain precisely why ‚Äúor‚Äù belongs with union and ‚Äúand‚Äù with intersection, in terms of membership conditions.
      </li>
    </ol>

    <h3>[5] Creative (design a union/intersection puzzle)</h3>
    <p><strong>(U3.5)</strong><br>
      Create your own puzzle involving <strong>three sets</strong> \(A,B,C\subseteq\{1,\dots,10\}\) such that:
    </p>
    <ol>
      <li>
        You specify the sizes of:
        <ul>
          <li>\(|A\cup B|\), \(|B\cup C|\), \(|A\cup C|\),</li>
          <li>\(|A\cap B|\), \(|B\cap C|\), \(|A\cap C|\),</li>
          <li>\(|A\cup B\cup C|\).</li>
        </ul>
      </li>
      <li>Ask the reader to determine <strong>all possible triples</strong> \((|A|,|B|,|C|)\) consistent with your data.</li>
      <li>Solve your own puzzle.</li>
      <li>
        Write a brief explanation of how the inclusion‚Äìexclusion intuition appears in your construction,
        even though the chapter hasn‚Äôt formally stated it yet.
      </li>
    </ol>

    <!-- Notes + drawing -->
    <div class="group-notes">
      <h3>Notes for Group 3</h3>
      <div class="note">Type \\ quickly to open the LaTeX snippet app on this note.</div>
      <textarea class="latex-input"
        placeholder="Check unions/intersections, then build your own inclusion‚Äìexclusion style puzzle in U3.5."></textarea>
      <div class="rendered-output"></div>
      <div class="controls">
        <button class="copy-btn">Copy problems + notes</button>
      </div>
    </div>
    <div class="canvas-block">
      <div class="note">Use the canvas for Venn diagrams and family-chain sketches.</div>
      <div class="canvas-wrapper">
        <canvas class="note-canvas"></canvas>
      </div>
      <button class="copy-btn clear-canvas">Clear drawing</button>
    </div>
  </section>

  <!-- 4. Ordered Pairs, Tuples & Cartesian Products -->
  <section class="problem-group" id="group-4">
    <h2>4. Ordered Pairs, Tuples &amp; Cartesian Products</h2>
    <p><em>Core ideas</em>: Kuratowski pairs, \(A^n\), segments and initial segments of sequences.</p>

    <h3>[1] Pure type</h3>
    <p><strong>(P4.1)</strong><br>
      Using Kuratowski‚Äôs definition \(\langle x,y\rangle = \{\{x\},\{x,y\}\}\):
    </p>
    <ol>
      <li>Compute \(\langle 1,2\rangle\) and \(\langle 2,1\rangle\) explicitly as sets.</li>
      <li>Find an element that belongs to one but not the other (if any).</li>
      <li>
        Explain why this shows \(\langle 1,2\rangle\neq\langle 2,1\rangle\) even though \(\{1,2\}=\{2,1\}\).
      </li>
    </ol>

    <h3>[2] Variation (building tuples from pairs)</h3>
    <p><strong>(P4.2)</strong><br>
      Using the recursive definition of \(n\)-tuples
      \(\langle x_1,\dots,x_{n+1}\rangle = \langle\langle x_1,\dots,x_n\rangle,x_{n+1}\rangle\):
    </p>
    <ol>
      <li>Write \(\langle a,b,c\rangle\) purely in terms of sets and \(\langle\cdot,\cdot\rangle\).</li>
      <li>Do the same for \(\langle 0,1,2,3\rangle\).</li>
      <li>
        Describe in words how this recursive construction ensures that tuples of different lengths
        are never confused.
      </li>
    </ol>

    <h3>[3] Fusion (segments / initial segments)</h3>
    <p><strong>(P4.3)</strong><br>
      Let \(S = \langle a,b,c,d\rangle\).
    </p>
    <ol>
      <li>List all segments of \(S\).</li>
      <li>Identify which segments are initial segments and which are proper initial segments.</li>
      <li>
        Suppose \(\langle x_1,x_2,x_3,x_4\rangle\) is a proper initial segment of
        \(\langle y_1,\dots,y_7\rangle\). Draw a ‚Äúsolution path graph‚Äù of the reasoning needed to
        conclude relations among the \(x_i\) and \(y_j\).
      </li>
    </ol>

    <h3>[4] Hidden structure (Cartesian products &amp; relations)</h3>
    <p><strong>(P4.4)</strong><br>
      Let \(A = \{0,1\}\), \(B = \{a,b,c\}\).
    </p>
    <ol>
      <li>List all elements of \(A\times B\) and \(B\times A\).</li>
      <li>
        Define a relation \(R\subseteq A\times B\) by
        \[
        R = \{\langle 0,a\rangle,\langle 1,c\rangle\}.
        \]
        Write down \(\operatorname{dom}(R)\), \(\operatorname{ran}(R)\).
      </li>
      <li>
        Now define a relation \(S\subseteq B\times A\) by flipping each ordered pair of \(R\).
        Compare \(\operatorname{dom}(S)\), \(\operatorname{ran}(S)\) with those of \(R\).
      </li>
      <li>
        Explain how the ‚Äúdirection‚Äù of the ordered pair controls the meaning of domain and range.
      </li>
    </ol>

    <h3>[5] Creative (invent your own ordered-pair encoding)</h3>
    <p><strong>(P4.5)</strong><br>
      Define your own set-theoretic encoding of an ordered pair \(\langle x,y\rangle\) using only
      \(\{x\}\), \(\{y\}\), \(\{x,y\}\) and simple operations.
    </p>
    <ol>
      <li>State your definition clearly.</li>
      <li>
        Prove that it satisfies the ordered-pair uniqueness property:
        \[
        \langle x,y\rangle = \langle u,v\rangle\iff x=u \text{ and } y=v.
        \]
      </li>
      <li>
        Compare your encoding with Kuratowski‚Äôs: describe one advantage (maybe simplicity) and one
        disadvantage (maybe nesting depth or ambiguity).
      </li>
    </ol>

    <!-- Notes + drawing -->
    <div class="group-notes">
      <h3>Notes for Group 4</h3>
      <div class="note">Type \\ quickly to open the LaTeX snippet app on this note.</div>
      <textarea class="latex-input"
        placeholder="Unfold Kuratowski pairs into sets, then explore your own encoding and domain/range behavior."></textarea>
      <div class="rendered-output"></div>
      <div class="controls">
        <button class="copy-btn">Copy problems + notes</button>
      </div>
    </div>
    <div class="canvas-block">
      <div class="note">Use the canvas for nesting diagrams of pair/tuple encodings and product grids.</div>
      <div class="canvas-wrapper">
        <canvas class="note-canvas"></canvas>
      </div>
      <button class="copy-btn clear-canvas">Clear drawing</button>
    </div>
  </section>

  <!-- 5. Relations & Their Properties -->
  <section class="problem-group" id="group-5">
    <h2>5. Relations &amp; Their Properties</h2>
    <p><em>Core ideas</em>: Classifying relations; understanding behavior of equivalence and order.</p>

    <h3>[1] Pure type</h3>
    <p><strong>(R5.1)</strong><br>
      On the set \(A= \{1,2,3\}\), consider these relations:
    </p>
    <ul>
      <li>\(R_1 = \{\langle 1,1\rangle,\langle 2,2\rangle,\langle 3,3\rangle\}\)</li>
      <li>\(R_2 = \{\langle 1,2\rangle,\langle 2,1\rangle\}\)</li>
      <li>\(R_3 = \{\langle 1,2\rangle,\langle 2,3\rangle,\langle 1,3\rangle\}\)</li>
    </ul>
    <p>For each relation, decide whether it is:</p>
    <ol>
      <li>reflexive on \(A\),</li>
      <li>symmetric,</li>
      <li>transitive.</li>
    </ol>

    <h3>[2] Variation (design &amp; classify)</h3>
    <p><strong>(R5.2)</strong><br>
      Still on \(A = \{1,2,3\}\), <strong>design</strong> three new relations:
    </p>
    <ol>
      <li>One that is symmetric and transitive but <strong>not</strong> reflexive.</li>
      <li>One that is reflexive and symmetric but <strong>not</strong> transitive.</li>
      <li>One that is reflexive and transitive but <strong>not</strong> symmetric.</li>
    </ol>
    <p>For each, write it as a set of ordered pairs and justify your classification.</p>

    <h3>[3] Fusion (equivalence vs order on \(\mathbb{Z}\))</h3>
    <p><strong>(R5.3)</strong><br>
      On \(\mathbb{Z}\):
    </p>
    <ul>
      <li>Let \(a \sim b\) iff \(a-b\) is divisible by 3.</li>
      <li>Let \(a \prec b\) iff \(a&lt;b\).</li>
    </ul>
    <ol>
      <li>Prove that \(\sim\) is an equivalence relation.</li>
      <li>Prove that \(\prec\) is a strict ordering relation (in the sense of the notes).</li>
      <li>
        Describe the ‚Äúshape‚Äù of the equivalence classes under \(\sim\) and compare them with the ‚Äúshape‚Äù
        of chains under \(\prec\).
      </li>
      <li>Explain why these two behaviors are so different that we give them separate names.</li>
    </ol>

    <h3>[4] Hidden structure (construct a relation from a description)</h3>
    <p><strong>(R5.4)</strong><br>
      On \(\mathbb{Z}^2\), define a relation \(R\) on ordered pairs by:
      \[
      \langle a,b\rangle R \langle c,d\rangle \iff a+d = b+c.
      \]
    </p>
    <ol>
      <li>Prove or disprove: \(R\) is an equivalence relation on \(\mathbb{Z}^2\).</li>
      <li>If it is, describe the equivalence classes (e.g. as some simple algebraic condition).</li>
      <li>
        Explain how this relation is capturing a kind of ‚Äúdiagonal‚Äù structure in the integer lattice.
      </li>
    </ol>

    <h3>[5] Creative (relational zoo with full property spectrum)</h3>
    <p><strong>(R5.5)</strong><br>
      On \(A=\{0,1,2,3\}\), construct <strong>six different relations</strong> \(R_1,\dots,R_6\) so that:
    </p>
    <ul>
      <li>One has <strong>all</strong> of: reflexive, symmetric, transitive.</li>
      <li>One has <strong>none</strong> of them.</li>
      <li>One has exactly: reflexive only.</li>
      <li>One has exactly: symmetric only.</li>
      <li>One has exactly: transitive only.</li>
      <li>One has exactly: symmetric and transitive (but not reflexive).</li>
    </ul>
    <p>For each relation:</p>
    <ol>
      <li>List its ordered pairs.</li>
      <li>Fill in a small property table indicating which properties it has.</li>
      <li>
        Write one or two sentences explaining what ‚Äútype‚Äù of behavior it models (identity-like,
        swap-like, order-like, etc.).
      </li>
    </ol>

    <!-- Notes + drawing -->
    <div class="group-notes">
      <h3>Notes for Group 5</h3>
      <div class="note">Type \\ quickly to open the LaTeX snippet app on this note.</div>
      <textarea class="latex-input"
        placeholder="Classify relations, then design a full 'property spectrum' zoo on {0,1,2,3}."></textarea>
      <div class="rendered-output"></div>
      <div class="controls">
        <button class="copy-btn">Copy problems + notes</button>
      </div>
    </div>
    <div class="canvas-block">
      <div class="note">Use the canvas for relation graphs and property tables.</div>
      <div class="canvas-wrapper">
        <canvas class="note-canvas"></canvas>
      </div>
      <button class="copy-btn clear-canvas">Clear drawing</button>
    </div>
  </section>

  <!-- 6. Functions & Operations, Restriction & Closure -->
  <section class="problem-group" id="group-6">
    <h2>6. Functions &amp; Operations, Restriction &amp; Closure</h2>
    <p><em>Core ideas</em>: Function as special relation; injective/surjective; operations as \(A^n\to A\); closure.</p>

    <h3>[1] Pure type</h3>
    <p><strong>(F6.1)</strong><br>
      Decide whether each relation \(F\subseteq\{0,1,2\}^2\) is a function from \(\{0,1,2\}\) to
      \(\{0,1,2\}\). If it is, give its domain and range.
    </p>
    <ol>
      <li>\(F_1 = \{\langle 0,1\rangle,\langle 1,1\rangle,\langle 2,1\rangle\}\)</li>
      <li>\(F_2 = \{\langle 0,1\rangle,\langle 0,2\rangle\}\)</li>
      <li>\(F_3 = \{\langle 0,0\rangle,\langle 1,1\rangle\}\)</li>
    </ol>
    <p class="note"><em>Trap:</em> forgetting ‚Äúexactly one output for each input in the domain‚Äù.</p>

    <h3>[2] Variation (injective / surjective / bijective)</h3>
    <p><strong>(F6.2)</strong><br>
      Construct four functions \(f,g,h,k: \mathbb{Z}\to\mathbb{Z}\) such that:
    </p>
    <ol>
      <li>\(f\) is injective but not surjective.</li>
      <li>\(g\) is surjective but not injective.</li>
      <li>\(h\) is bijective.</li>
      <li>\(k\) is neither injective nor surjective.</li>
    </ol>
    <p>For each, give an explicit formula and briefly explain why it has the claimed properties.</p>

    <h3>[3] Fusion (operations &amp; restriction)</h3>
    <p><strong>(F6.3)</strong><br>
      Let \(+\) be addition on \(\mathbb{Z}\). Consider subsets:
    </p>
    <ul>
      <li>\(A = \mathbb{N}\) (with 0),</li>
      <li>\(B = \{0,2,4,6,\dots\}\),</li>
      <li>\(C = \{0,1\}\).</li>
    </ul>
    <ol>
      <li>For each of \(A,B,C\), decide whether it is closed under \(+\).</li>
      <li>
        For each subset that is closed, describe explicitly the restricted operation
        \(+!\upharpoonright (X^2)\) as a binary operation on \(X\).
      </li>
      <li>
        For each subset that is not closed, give a specific counterexample and explain why this prevents
        the restriction from being a binary operation on \(X\).
      </li>
    </ol>

    <h3>[4] Hidden structure (function vs ‚Äútotal relation on A‚Äù)</h3>
    <p><strong>(F6.4)</strong><br>
      A student says:
    </p>
    <blockquote>
      ‚ÄúA function \(F:A\to B\) is just any relation with domain \(A\) and range contained in \(B\).‚Äù
    </blockquote>
    <ol>
      <li>
        Either prove or refute this statement. If you refute it, construct a counterexample relation on a
        small finite set.
      </li>
      <li>
        Carefully compare his definition with the one in the notes
        (‚Äúfor each \(x\in\operatorname{dom}(F)\), there is exactly one \(y\) with \(\langle x,y\rangle\in F\)‚Äù).
      </li>
      <li>Explain in your own words why the ‚Äúexactly one‚Äù condition matters so much.</li>
    </ol>

    <h3>[5] Creative (design an n-ary operation with a special property)</h3>
    <p><strong>(F6.5)</strong><br>
      Define your own <strong>3-ary operation</strong> \(T: \mathbb{Z}^3\to\mathbb{Z}\).
    </p>
    <ol>
      <li>
        Give a formula for \(T(x,y,z)\) with some intended property (for example, symmetric in all
        arguments, or a ‚Äúmajority vote‚Äù operation on \(\{0,1\}\)).
      </li>
      <li>Prove the property you care about (e.g., symmetry).</li>
      <li>
        Suggest a real-world or combinatorial interpretation of this operation.
      </li>
    </ol>

    <!-- Notes + drawing -->
    <div class="group-notes">
      <h3>Notes for Group 6</h3>
      <div class="note">Type \\ quickly to open the LaTeX snippet app on this note.</div>
      <textarea class="latex-input"
        placeholder="Sort examples into injective/surjective/closed, and design your own 3-ary operation T."></textarea>
      <div class="rendered-output"></div>
      <div class="controls">
        <button class="copy-btn">Copy problems + notes</button>
      </div>
    </div>
    <div class="canvas-block">
      <div class="note">Use the canvas for mapping diagrams and closure-counterexample sketches.</div>
      <div class="canvas-wrapper">
        <canvas class="note-canvas"></canvas>
      </div>
      <button class="copy-btn clear-canvas">Clear drawing</button>
    </div>
  </section>

  <!-- 7. Equivalence Relations & Partitions -->
  <section class="problem-group" id="group-7">
    <h2>7. Equivalence Relations &amp; Partitions</h2>
    <p><em>Core ideas</em>: Equivalence as reflexive-symmetric-transitive; classes form a partition; partition ‚Üî relation.</p>

    <h3>[1] Pure type</h3>
    <p><strong>(Q7.1)</strong><br>
      On \(\mathbb{Z}\), define \(a \sim b\) iff \(a-b\) is even.
    </p>
    <ol>
      <li>Show that \(\sim\) is an equivalence relation.</li>
      <li>Describe all distinct equivalence classes.</li>
      <li>Check that these classes are disjoint and cover \(\mathbb{Z}\).</li>
    </ol>

    <h3>[2] Variation (mod n equivalence &amp; divisor-count)</h3>
    <p><strong>(Q7.2)</strong><br>
      On \(\mathbb{Z}\), define \(a \approx b\) iff \(a-b\) is divisible by 3.
    </p>
    <ol>
      <li>Identify the three equivalence classes explicitly.</li>
      <li>For each integer \(n\) with \(|n|\le 10\), say which class it belongs to.</li>
      <li>Explain why <strong>every</strong> integer belongs to exactly one of the three classes.</li>
    </ol>

    <h3>[3] Fusion (partition ‚Üí relation and back)</h3>
    <p><strong>(Q7.3)</strong><br>
      Let \(\mathbb{Z}\) be partitioned into four sets:
    </p>
    <ul>
      <li>\(A_0 = \{n\in\mathbb{Z}\mid n\equiv 0 \pmod{4}\}\)</li>
      <li>\(A_1 = \{n\in\mathbb{Z}\mid n\equiv 1 \pmod{4}\}\)</li>
      <li>\(A_2 = \{n\in\mathbb{Z}\mid n\equiv 2 \pmod{4}\}\)</li>
      <li>\(A_3 = \{n\in\mathbb{Z}\mid n\equiv 3 \pmod{4}\}\)</li>
    </ul>
    <ol>
      <li>Use this partition to define an equivalence relation \(R\) on \(\mathbb{Z}\).</li>
      <li>Prove directly that \(R\) is reflexive, symmetric, and transitive.</li>
      <li>Show that the equivalence classes of \(R\) are <strong>exactly</strong> the four sets \(A_0,A_1,A_2,A_3\).</li>
    </ol>

    <h3>[4] Hidden structure (equivalence + order on classes)</h3>
    <p><strong>(Q7.4)</strong><br>
      On \(\mathbb{Z}\):
    </p>
    <ul>
      <li>Let \(\sim\) be ‚Äúsame remainder modulo 3‚Äù as in (Q7.2).</li>
      <li>
        Define an order on the set of equivalence classes \(\mathbb{Z}/\sim\) by:
        \[
        [a] &lt; [b] \iff \text{the least nonnegative representative of }[a]\text{ is less than that of }[b].
        \]
      </li>
    </ul>
    <ol>
      <li>Check that this gives a strict ordering on the set of equivalence classes.</li>
      <li>Draw a diagram showing the three classes as nodes and the order among them.</li>
      <li>
        Explain in words what kind of ‚Äúcoarse ordering‚Äù this creates compared to the usual order on \(\mathbb{Z}\).
      </li>
    </ol>

    <h3>[5] Creative (invent a non-modular equivalence on \(\mathbb{Z}\))</h3>
    <p><strong>(Q7.5)</strong><br>
      Define a <strong>new</strong> equivalence relation \(\approx\) on \(\mathbb{Z}\) that is
      <em>not</em> congruence modulo \(n\) for any fixed \(n\).
    </p>
    <ol>
      <li>
        Describe your relation informally (e.g. ‚Äútwo integers are equivalent if they have the same absolute
        value‚Äù, or ‚Äúif they eventually agree after repeatedly applying some operation‚Äù).
      </li>
      <li>Give a precise set-theoretic definition of \(\approx\).</li>
      <li>Prove that \(\approx\) is reflexive, symmetric, and transitive.</li>
      <li>Describe the equivalence classes and explain why they form a partition of \(\mathbb{Z}\).</li>
    </ol>

    <!-- Notes + drawing -->
    <div class="group-notes">
      <h3>Notes for Group 7</h3>
      <div class="note">Type \\ quickly to open the LaTeX snippet app on this note.</div>
      <textarea class="latex-input"
        placeholder="Work through mod classes, then invent your own non-mod equivalence and its partition of ‚Ñ§."></textarea>
      <div class="rendered-output"></div>
      <div class="controls">
        <button class="copy-btn">Copy problems + notes</button>
      </div>
    </div>
    <div class="canvas-block">
      <div class="note">Use the canvas for partition blocks and class-level order diagrams.</div>
      <div class="canvas-wrapper">
        <canvas class="note-canvas"></canvas>
      </div>
      <button class="copy-btn clear-canvas">Clear drawing</button>
    </div>
  </section>
</main>


  <!-- Root for the React symbol popup -->
  <div id="symbol-popup-root"></div>

  <!-- React + ReactDOM + Babel (for JSX in this example) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- React + JSX: ONLY the popup component + showSymbolPopup -->
  <script type="text/babel" data-presets="env,react">
    // ---------- Symbol data (you can expand this later) ----------
    window.SYMBOLS = [];
    window.RECENT_SYMBOLS = [];

    // ---------- Simple search ----------
    function searchSymbols(symbols, query) {
      const q = query.trim().toLowerCase();

      const recentList = Array.isArray(window.RECENT_SYMBOLS)
        ? window.RECENT_SYMBOLS
        : [];
      const recentSet = new Set(recentList);

      // ---------- Case 1: empty query ‚Üí show recent first ----------
      if (!q) {
        const seen = new Set();
        const recent = [];
        const others = [];

        // 1) Put recents first, in recency order
        for (const latex of recentList) {
          const sym = symbols.find((s) => s.latex === latex);
          if (sym && !seen.has(sym.latex)) {
            recent.push(sym);
            seen.add(sym.latex);
          }
        }

        // 2) Then all other symbols, sorted by priority
        for (const s of symbols) {
          if (!seen.has(s.latex)) {
            others.push(s);
          }
        }

        others.sort((a, b) => (b.priority || 0) - (a.priority || 0));

        return [...recent, ...others].slice(0, 20);
      }

      // ---------- Case 2: non-empty query ‚Üí scoring with recency boost ----------
      return symbols
        .map((s) => {
          const haystack = [
            s.label,
            s.latex,
            ...(s.keywords || []),
            ...(s.categories || [])
          ].join(" ").toLowerCase();

          if (!haystack.includes(q)) return null;

          let score = s.priority || 0;

          // Strong boost if this is a recent symbol
          const recIndex = recentList.indexOf(s.latex);
          if (recIndex !== -1) {
            const recencyWeight = 1.0 + (recentList.length - recIndex) * 0.05;
            score += recencyWeight;
          }

          if (s.latex.toLowerCase().startsWith("\\" + q)) score += 0.7;
          if ((s.keywords || []).some((k) => k.toLowerCase() === q)) score += 0.5;
          if (s.label.toLowerCase() === q) score += 0.4;

          const idx = haystack.indexOf(q);
          if (idx >= 0) score += Math.max(0, 0.3 - idx / 50);

          return { s, score };
        })
        .filter(Boolean)
        .sort((a, b) => b.score - a.score)
        .map((x) => x.s)
        .slice(0, 20);
    }


    // ---------- React popup component ----------
    const SymbolPopup = ({ x, y, initialQuery = "", onSelect, onClose }) => {
        const [query, setQuery] = React.useState("");
        const [highlightIndex, setHighlightIndex] = React.useState(0);
        const containerRef = React.useRef(null);
        const inputRef = React.useRef(null);

        const results = React.useMemo(
          () => searchSymbols(window.SYMBOLS || [], query),
          [query]
        );

        React.useEffect(() => {
          if (inputRef.current) {
            setTimeout(() => inputRef.current.focus(), 0);
          }
        }, []);

      React.useEffect(() => {
        if (inputRef.current) {
          setTimeout(() => inputRef.current.focus(), 0);
        }
      }, []);

      React.useEffect(() => {
        function handleClickOutside(e) {
          if (!containerRef.current) return;
          if (!containerRef.current.contains(e.target)) {
            onClose();
          }
        }
        document.addEventListener("mousedown", handleClickOutside);
        return () => document.removeEventListener("mousedown", handleClickOutside);
      }, [onClose]);

      const handleKeyDown = (e) => {
        const count = results.length;
        if (e.key === "ArrowDown") {
          e.preventDefault();
          if (count === 0) return;
          setHighlightIndex((prev) => (prev + 1) % count);
        } else if (e.key === "ArrowUp") {
          e.preventDefault();
          if (count === 0) return;
          setHighlightIndex((prev) => (prev - 1 + count) % count);
        } else if (e.key === "Enter") {
          e.preventDefault();
          if (count === 0) return;
          onSelect(results[highlightIndex]);
        } else if (e.key === "Escape") {
          e.preventDefault();
          onClose();
        }
      };

      return (
        <div
          ref={containerRef}
          style={{
            position: "absolute",
            left: x,
            top: y,
            zIndex: 9999,
            minWidth: 260,
            maxWidth: 360,
            background: "#fff",
            border: "1px solid #ddd",
            borderRadius: 6,
            boxShadow: "0 8px 24px rgba(0,0,0,0.12)",
            padding: 8,
            fontFamily:
              'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif',
            fontSize: 13
          }}
        >
          <input
            ref={inputRef}
            value={query}
            onChange={(e) => {
              setQuery(e.target.value);
              setHighlightIndex(0);
            }}
            onKeyDown={handleKeyDown}
            placeholder="Search symbol or LaTeX‚Ä¶"
            style={{
              width: "100%",
              boxSizing: "border-box",
              padding: "4px 6px",
              marginBottom: 6,
              borderRadius: 4,
              border: "1px solid #ccc",
              outline: "none"
            }}
          />

          <div style={{ maxHeight: 260, overflowY: "auto" }}>
            {results.map((sym, idx) => (
              <div
                key={sym.latex + idx}
                style={{
                  display: "flex",
                  alignItems: "center",
                  padding: "4px 6px",
                  borderRadius: 4,
                  background: idx === highlightIndex ? "#eef3ff" : "transparent",
                  cursor: "pointer"
                }}
                onMouseDown={(e) => {
                  e.preventDefault();
                  onSelect(sym);
                }}
              >
                <span
                  style={{
                    width: 32,
                    textAlign: "center",
                    fontSize: 18,
                    marginRight: 6
                  }}
                >
                  {sym.label}
                </span>
                <div
                  style={{
                    display: "flex",
                    flexDirection: "column",
                    flex: 1,
                    overflow: "hidden"
                  }}
                >
                  <span
                    style={{
                      fontFamily: "monospace",
                      fontSize: 12,
                      whiteSpace: "nowrap",
                      overflow: "hidden",
                      textOverflow: "ellipsis"
                    }}
                  >
                    {sym.latex}
                  </span>
                  {sym.keywords && sym.keywords.length > 0 && (
                    <span
                      style={{
                        fontSize: 11,
                        color: "#777",
                        whiteSpace: "nowrap",
                        overflow: "hidden",
                        textOverflow: "ellipsis"
                      }}
                    >
                      {sym.keywords.slice(0, 4).join(", ")}
                    </span>
                  )}
                </div>
              </div>
            ))}

            {results.length === 0 && (
              <div
                style={{
                  padding: "4px 6px",
                  fontSize: 12,
                  color: "#888"
                }}
              >
                No matches
              </div>
            )}
          </div>
        </div>
      );
    };

    // ---------- Helper: show popup from vanilla JS ----------
    const popupRoot = ReactDOM.createRoot(
      document.getElementById("symbol-popup-root")
    );

    window.showSymbolPopup = function ({ x, y, initialQuery, onSelect }) {
      const handleSelect = (symbol) => {
        // --- Update recent list (per session, in-memory) ---
        if (!Array.isArray(window.RECENT_SYMBOLS)) {
          window.RECENT_SYMBOLS = [];
        }
        const arr = window.RECENT_SYMBOLS;
        const latex = symbol.latex;

        // Remove if already present
        const existingIndex = arr.indexOf(latex);
        if (existingIndex !== -1) {
          arr.splice(existingIndex, 1);
        }
        // Add to front
        arr.unshift(latex);
        // Keep list bounded (e.g. last 30 unique symbols)
        if (arr.length > 30) {
          arr.length = 30;
        }

        // Pass selection back to caller (inserts in textarea, etc.)
        onSelect(symbol);

        // Close popup
        popupRoot.render(null);
      };

      const handleClose = () => {
        popupRoot.render(null);
      };

      popupRoot.render(
        <SymbolPopup
          x={x}
          y={y}
          initialQuery={initialQuery}
          onSelect={handleSelect}
          onClose={handleClose}
        />
      );
    };

  </script>

  <!-- Plain JS: MathJax rendering, copy, canvas, backslash trigger -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Load symbols.json
      fetch("../../symbols.json")
        .then((res) => res.json())
        .then((data) => {
          window.SYMBOLS = Array.isArray(data) ? data : (data.symbols || []);
          console.log("Loaded symbols:", window.SYMBOLS.length);
        })
        .catch((err) => {
          console.error("Failed to load symbols.json", err);
          window.SYMBOLS = [];
        });

      function renderBlockTeX(textarea, outputElement) {
        const raw = textarea.value.trim();
        if (!raw) {
          if (outputElement) outputElement.innerHTML = "";
          return;
        }

        let tex = raw;
        const explicitDisplayOrEnv = /^(\$\$|\\\[|\\begin\{)/.test(raw);
        const looksMultiline = raw.includes("\\\\") || raw.includes("\n");

        if (!explicitDisplayOrEnv) {
          if (looksMultiline) {
            tex = "\\begin{gather*}\n" + raw + "\n\\end{gather*}";
          } else {
            tex = "\\[" + raw + "\\]";
          }
        }

        if (!outputElement) return;
        outputElement.textContent = tex;

        if (window.MathJax && MathJax.typesetPromise) {
          MathJax.typesetPromise([outputElement]).catch((err) =>
            console.error(err)
          );
        }
      }

      function insertAtCursor(textarea, text) {
        if (!textarea) return;
        const start = textarea.selectionStart != null ? textarea.selectionStart : textarea.value.length;
        const end   = textarea.selectionEnd != null ? textarea.selectionEnd : textarea.value.length;
        const value = textarea.value;

        textarea.value = value.slice(0, start) + text + value.slice(end);
        const newPos = start + text.length;

        textarea.focus();
        textarea.selectionStart = textarea.selectionEnd = newPos;
        textarea.dispatchEvent(new Event("input", { bubbles: true }));
      }

      // ---------- Notes textareas ----------
      const allTextareas = document.querySelectorAll(".latex-input");

      // ========================================================
      // Opens the popup based on the textarea cursor position
      // ========================================================
      function openPopupAtTextareaCursor(ta) {
        const rect = ta.getBoundingClientRect();
        const x = rect.left + window.scrollX + 40;
        const y = rect.top + window.scrollY + 20;

        const pos = ta.selectionStart != null ? ta.selectionStart : ta.value.length;
        const value = ta.value;

        let initialQuery = "";
        const lastBackslash = value.lastIndexOf("\\", pos - 1);
        if (lastBackslash !== -1 && lastBackslash < pos) {
          initialQuery = value.slice(lastBackslash + 1, pos);
        }

        if (window.showSymbolPopup) {
          window.showSymbolPopup({
            x,
            y,
            initialQuery,
            onSelect(symbol) {
              insertAtCursor(ta, symbol.latex);
            }
          });
        }
      }

      allTextareas.forEach((ta) => {
        // Live render on input
        ta.addEventListener("input", () => {
          const box = ta.closest(".group-notes");
          if (!box) return;
          const out = box.querySelector(".rendered-output");
          renderBlockTeX(ta, out);
        });

        let lastBackslashTime = 0;

        ta.addEventListener("keydown", (e) => {
          if (e.key === "\\") {
            const now = Date.now();

            // Rapid double press ‚Üí treat as shortcut
            if (now - lastBackslashTime < 250) {
              e.preventDefault(); // don't type this second "\"

              // üî• Remove the *previous* "\" that was just typed
              const pos = ta.selectionStart != null ? ta.selectionStart : ta.value.length;
              const value = ta.value;

              if (pos > 0 && value[pos - 1] === "\\") {
                ta.value = value.slice(0, pos - 1) + value.slice(pos);
                ta.selectionStart = ta.selectionEnd = pos - 1;
                // re-render after change
                ta.dispatchEvent(new Event("input", { bubbles: true }));
              }

              // Open the popup at the cursor
              openPopupAtTextareaCursor(ta);
              lastBackslashTime = 0; // reset
              return;
            }

            // First "\" ‚Üí let it type normally
            lastBackslashTime = now;
          }
        });

        // Optional: initial render
        const box = ta.closest(".group-notes");
        if (box) {
          const out = box.querySelector(".rendered-output");
          renderBlockTeX(ta, out);
        }
      });



      // ---------- Copy buttons ----------
      const noteGroups = document.querySelectorAll(".group-notes");
      noteGroups.forEach((group) => {
        const section  = group.closest(".problem-group");
        const textarea = group.querySelector(".latex-input");
        const button   = group.querySelector(".copy-btn");

        if (!button || !textarea || !section) return;

        button.addEventListener("click", async () => {
          const problems = Array.from(
            section.querySelectorAll(":scope > p")
          ).map((p) => p.textContent.trim());

          const problemBlock =
            "Problems:\n" +
            problems.map((t, i) => `${i + 1}. ${t}`).join("\n") +
            "\n\n";

          const latex = textarea.value.trim();
          const notesBlock = "Notes (LaTeX):\n" + latex + "\n";

          const combined = problemBlock + notesBlock;

          try {
            await navigator.clipboard.writeText(combined);
            button.classList.add("copied");
            setTimeout(() => button.classList.remove("copied"), 1200);
          } catch (err) {
            console.error("Clipboard error:", err);
            alert("Copy failed ‚Äì your browser may block clipboard access.");
          }
        });
      });

      // ---------- Drawing canvases ----------
      const canvases = document.querySelectorAll(".note-canvas");
      canvases.forEach((canvas) => {
        const ctx = canvas.getContext("2d");
        const clearBtn = canvas.closest(".canvas-block").querySelector(".clear-canvas");

        function resizeCanvas() {
          const rect = canvas.getBoundingClientRect();
          const dpr = window.devicePixelRatio || 1;

          canvas.width  = rect.width * dpr;
          canvas.height = rect.height * dpr;

          ctx.setTransform(1, 0, 0, 1, 0, 0);
          ctx.scale(dpr, dpr);

          ctx.lineCap = "round";
          ctx.lineJoin = "round";
          ctx.lineWidth = 2;
        }

        resizeCanvas();
        window.addEventListener("resize", resizeCanvas);

        let drawing = false;
        let lastX = 0;
        let lastY = 0;

        function getPos(evt) {
          const rect = canvas.getBoundingClientRect();
          if (evt.touches && evt.touches[0]) {
            return {
              x: evt.touches[0].clientX - rect.left,
              y: evt.touches[0].clientY - rect.top
            };
          } else {
            return {
              x: evt.clientX - rect.left,
              y: evt.clientY - rect.top
            };
          }
        }

        function startDraw(evt) {
          evt.preventDefault();
          drawing = true;
          const pos = getPos(evt);
          lastX = pos.x;
          lastY = pos.y;
        }

        function draw(evt) {
          if (!drawing) return;
          evt.preventDefault();
          const pos = getPos(evt);
          ctx.beginPath();
          ctx.moveTo(lastX, lastY);
          ctx.lineTo(pos.x, pos.y);
          ctx.stroke();
          lastX = pos.x;
          lastY = pos.y;
        }

        function endDraw(evt) {
          if (!drawing) return;
          evt.preventDefault();
          drawing = false;
        }

        canvas.addEventListener("mousedown", startDraw);
        canvas.addEventListener("mousemove", draw);
        window.addEventListener("mouseup", endDraw);

        canvas.addEventListener("touchstart", startDraw, { passive: false });
        canvas.addEventListener("touchmove", draw, { passive: false });
        canvas.addEventListener("touchend", endDraw, { passive: false });
        canvas.addEventListener("touchcancel", endDraw, { passive: false });

        if (clearBtn) {
          clearBtn.addEventListener("click", () => {
            const rect = canvas.getBoundingClientRect();
            ctx.clearRect(0, 0, rect.width, rect.height);
          });
        }
      });
    });
  </script>

</body>
</html>