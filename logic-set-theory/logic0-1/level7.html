<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Logic 0 ‚Äì Level 7</title>

  <!-- Basic layout styles -->
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
                   sans-serif;
      line-height: 1.5;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }

    header {
      background: #222;
      color: #fff;
      padding: 1rem 1.5rem;
    }

    header h1 {
      margin: 0;
      font-size: 1.6rem;
    }

    main {
      max-width: 900px;
      margin: 1.5rem auto 3rem;
      padding: 0 1rem 2rem;
      background: #fff;
      box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.08);
      border-radius: 8px;
    }

    section {
      margin-bottom: 2rem;
    }

    h2 {
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
      font-size: 1.3rem;
    }

    h3 {
      margin-top: 1rem;
      margin-bottom: 0.4rem;
      font-size: 1.1rem;
    }

    .note {
      font-size: 0.9rem;
      color: #555;
      margin-bottom: 0.8rem;
    }

    .problem-group {
      border-top: 1px solid #eee;
      padding-top: 1.25rem;
      margin-top: 1.25rem;
    }

    .problem-group:first-of-type {
      border-top: none;
      padding-top: 0;
      margin-top: 0.5rem;
    }

    .latex-input {
      width: 100%;
      min-height: 70px;
      padding: 0.5rem;
      font-family: "Fira Code", "JetBrains Mono", Menlo, Monaco,
                   Consolas, "Courier New", monospace;
      font-size: 0.95rem;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      resize: vertical;
      margin-bottom: 0.5rem;
    }

    .rendered-output {
      min-height: 2rem;
      padding: 0.5rem;
      border-radius: 4px;
      border: 1px dashed #ccc;
      background: #fafafa;
      margin-bottom: 0.5rem;
      text-align: center;
    }

    .rendered-output mjx-container {
      display: inline-block;
      margin-left: auto;
      margin-right: auto;
    }

    .controls {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-bottom: 0.3rem;
    }

    .copy-btn {
      padding: 0.3rem 0.7rem;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      background: #333;
      color: #fff;
      font-size: 0.9rem;
    }

    .copy-btn:active {
      transform: scale(0.97);
    }

    .copy-btn.copied::after {
      content: " ‚úì";
    }

    .canvas-wrapper {
      border: 1px solid #ccc;
      border-radius: 4px;
      overflow: hidden;
      background: #fff;
    }

    .canvas-block {
      margin-top: 0.75rem;
    }

    .note-canvas {
      display: block;
      width: 100%;
      height: 250px;
      touch-action: none; /* for better touch drawing */
    }

    .clear-canvas {
      margin-top: 0.4rem;
    }



  </style>

  <!-- MathJax for LaTeX rendering -->
  <script>
    window.MathJax = {
      tex: {
        packages: { "[+]": ["ams"] },
        inlineMath: [["\\(","\\)"], ["$","$"]],
        displayMath: [["\\[","\\]"], ["$$","$$"]]
      },
      svg: { fontCache: "global" }
    };
  </script>

  <script id="MathJax-script"
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"
          async></script>
</head>
<body>
  <header>
    <h1>Logic 0 ‚Äì Level 7 Problems</h1>
  </header>

  <main>
  <section>
    <p class="note">
      This page contains a boss-tier problem bank H1‚ÄìH12 built only from the tools in <code>0logic.pdf</code>:
      sets, power sets, unions/intersections, ordered pairs/tuples, Cartesian products, relations, functions,
      equivalence relations, partitions, etc. Each section has its own notes + canvas for working.
    </p>
  </section>

  <!-- H1 -->
  <section class="problem-group" id="H1">
    <h2>H1. Cantor‚Äôs Theorem for Your Chapter</h2>
    <p>
      Let \(A\) be any set and let \(\mathcal{P}(A)\) be its power set.
    </p>

    <p><strong>(a)</strong> Assume \(f:A\to\mathcal{P}(A)\) is an arbitrary function. Define
      \[
      B = \{ x\in A \mid x\notin f(x)\}.
      \]
    </p>
    <ol>
      <li>Prove that \(B\subseteq A\), so \(B\in\mathcal{P}(A)\).</li>
      <li>Show that there is no \(a\in A\) such that \(f(a)=B\).</li>
    </ol>

    <p><strong>(b)</strong> Conclude that there is <strong>no surjective function</strong> from \(A\) onto \(\mathcal{P}(A)\).</p>

    <p><strong>(c)</strong> Explain in words why this shows that ‚Äúthere are always strictly more subsets of a set than elements of the set itself‚Äù, using only the function + power set notions in the PDF.</p>

    <div class="group-notes">
      <h3>Notes for H1</h3>
      <div class="note">Type \\ to open the LaTeX snippet app and sketch the diagonal argument.</div>
      <textarea class="latex-input"
        placeholder="Work through the diagonal subset B and the non-surjectivity argument here."></textarea>
      <div class="rendered-output"></div>
      <div class="controls">
        <button class="copy-btn">Copy H1 + notes</button>
      </div>
    </div>
    <div class="canvas-block">
      <div class="note">Canvas: diagram A, f, and the diagonal set B.</div>
      <div class="canvas-wrapper">
        <canvas class="note-canvas"></canvas>
      </div>
      <button class="copy-btn clear-canvas">Clear drawing</button>
    </div>
  </section>

  <!-- H2 -->
  <section class="problem-group" id="H2">
    <h2>H2. Equivalence Relations ‚Üî Partitions (Full Two-Way Equivalence)</h2>
    <p>Let \(A\) be a nonempty set.</p>

    <p><strong>(a)</strong> Suppose \(R\) is an equivalence relation on \(A\). Define the set of equivalence classes
      \[
      A/R = \{[x]\mid x\in A\},\quad [x] = \{y\in A\mid \langle x,y\rangle\in R\}.
      \]
      Prove that:
    </p>
    <ol>
      <li>The classes in \(A/R\) are pairwise disjoint: if \([x]\cap [y]\neq\varnothing\), then \([x]=[y]\).</li>
      <li>The union of all classes is \(A\).</li>
    </ol>
    <p>So the equivalence classes form a <strong>partition</strong> of \(A\).</p>

    <p><strong>(b)</strong> Now start with a partition \(\mathcal{P}\) of \(A\): a set of nonempty subsets of \(A\) that are pairwise disjoint and whose union is \(A\).
      Define a relation \(R_{\mathcal{P}}\) by
      \[
      \langle x,y\rangle\in R_{\mathcal{P}} \iff x,y\text{ lie in the same block }P\in\mathcal{P}.
      \]
      Prove that \(R_{\mathcal{P}}\) is an equivalence relation.
    </p>

    <p><strong>(c)</strong> Show that the two constructions above are <strong>inverse</strong> in the following sense:</p>
    <ul>
      <li>Starting with an equivalence relation \(R\), forming its partition of classes, then forming the relation from that partition gives you back \(R\).</li>
      <li>Starting with a partition \(\mathcal{P}\), forming its relation, then forming the equivalence classes of that relation gives you back the original partition.</li>
    </ul>

    <div class="group-notes">
      <h3>Notes for H2</h3>
      <div class="note">Use this note to track the ‚Äúback-and-forth‚Äù constructions.</div>
      <textarea class="latex-input"
        placeholder="Prove disjointness + cover, then show (partition ‚Üí relation ‚Üí partition) and (relation ‚Üí partition ‚Üí relation) are inverses."></textarea>
      <div class="rendered-output"></div>
      <div class="controls">
        <button class="copy-btn">Copy H2 + notes</button>
      </div>
    </div>
    <div class="canvas-block">
      <div class="note">Canvas: draw partition blocks and arrows showing x ~ y iff they share a block.</div>
      <div class="canvas-wrapper">
        <canvas class="note-canvas"></canvas>
      </div>
      <button class="copy-btn clear-canvas">Clear drawing</button>
    </div>
  </section>

  <!-- H3 -->
  <section class="problem-group" id="H3">
    <h2>H3. Classifying Equivalence Relations on {1,2,3,4} with Blocks of Size 2</h2>

    <p>Consider all equivalence relations \(R\) on the set \(\{1,2,3,4\}\) such that <strong>every equivalence class has exactly two elements</strong>.</p>

    <p><strong>(a)</strong> Describe all possible partitions of \(\{1,2,3,4\}\) into blocks of size 2.</p>

    <p><strong>(b)</strong> For each such partition, write down the corresponding equivalence relation explicitly as a set of ordered pairs.</p>

    <p><strong>(c)</strong> Prove that these are <strong>all</strong> equivalence relations on \(\{1,2,3,4\}\) where each class has size 2; that is, show that no other equivalence relation can satisfy that property.</p>

    <div class="group-notes">
      <h3>Notes for H3</h3>
      <div class="note">Think in terms of perfect matchings on 4 labeled points.</div>
      <textarea class="latex-input"
        placeholder="List all pairings (1,2)|(3,4), etc., then expand to relations and argue classification completeness."></textarea>
      <div class="rendered-output"></div>
      <div class="controls">
        <button class="copy-btn">Copy H3 + notes</button>
      </div>
    </div>
    <div class="canvas-block">
      <div class="note">Canvas: draw pairing graphs for {1,2,3,4} and label blocks.</div>
      <div class="canvas-wrapper">
        <canvas class="note-canvas"></canvas>
      </div>
      <button class="copy-btn clear-canvas">Clear drawing</button>
    </div>
  </section>

  <!-- H4 -->
  <section class="problem-group" id="H4">
    <h2>H4. Infinite Equivalence Classes on ‚Ñï with Controlled Structure</h2>

    <p>Let \(\mathbb{N} = \{0,1,2,\dots\}\).</p>

    <p><strong>(a)</strong> Construct an equivalence relation \(\sim\) on \(\mathbb{N}\) such that:</p>
    <ol>
      <li>Every equivalence class is infinite.</li>
      <li>There are infinitely many different equivalence classes.</li>
    </ol>
    <p>(You must give a precise definition like ‚Äú\(a\sim b\) iff ‚Ä¶‚Äù.)</p>

    <p><strong>(b)</strong> Prove that your relation \(\sim\) is reflexive, symmetric, and transitive.</p>

    <p><strong>(c)</strong> Describe explicitly the equivalence classes, and prove that they are all infinite and pairwise distinct.</p>

    <div class="group-notes">
      <h3>Notes for H4</h3>
      <div class="note">Hint: think about congruence modulo n, or grouping by some infinite pattern.</div>
      <textarea class="latex-input"
        placeholder="Define your ‚àº, then prove properties and describe classes (e.g., mod n, parity, etc.)."></textarea>
      <div class="rendered-output"></div>
      <div class="controls">
        <button class="copy-btn">Copy H4 + notes</button>
      </div>
    </div>
    <div class="canvas-block">
      <div class="note">Canvas: visualize equivalence classes as infinite columns along ‚Ñï.</div>
      <div class="canvas-wrapper">
        <canvas class="note-canvas"></canvas>
      </div>
      <button class="copy-btn clear-canvas">Clear drawing</button>
    </div>
  </section>

  <!-- H5 -->
  <section class="problem-group" id="H5">
    <h2>H5. Symmetric-Difference-Finite on ùí´(‚Ñï)</h2>

    <p>Let \(\mathcal{P}(\mathbb{N})\) be the power set of \(\mathbb{N}\). Define, for \(A,B\subseteq\mathbb{N}\),
      \[
      A\Delta B = (A\setminus B)\cup (B\setminus A)
      \]
      (the symmetric difference), and define a relation \(\approx\) by
      \[
      A\approx B \iff A\Delta B\text{ is finite}.
      \]
    </p>

    <p><strong>(a)</strong> Prove that \(\approx\) is an equivalence relation on \(\mathcal{P}(\mathbb{N})\).</p>

    <p><strong>(b)</strong> Describe in words what it means for two subsets to be ‚Äúequivalent‚Äù under \(\approx\).</p>

    <p><strong>(c)</strong> Let \([A]\) denote the equivalence class of \(A\). For two classes \([A]\) and \([B]\), define:
      \[
      [A]\sqcup [B] := [A\cup B].
      \]
      Prove that \(\sqcup\) is <strong>well-defined</strong> on equivalence classes (i.e. it does not depend on the choice of representatives \(A\) and \(B\)).
    </p>

    <div class="group-notes">
      <h3>Notes for H5</h3>
      <div class="note">Track finite vs infinite symmetric differences carefully.</div>
      <textarea class="latex-input"
        placeholder="Show reflexive/symmetric/transitive, then prove [A]‚äî[B] is independent of representatives."></textarea>
      <div class="rendered-output"></div>
      <div class="controls">
        <button class="copy-btn">Copy H5 + notes</button>
      </div>
    </div>
    <div class="canvas-block">
      <div class="note">Canvas: draw example sets and their symmetric differences to build intuition.</div>
      <div class="canvas-wrapper">
        <canvas class="note-canvas"></canvas>
      </div>
      <button class="copy-btn clear-canvas">Clear drawing</button>
    </div>
  </section>

  <!-- H6 -->
  <section class="problem-group" id="H6">
    <h2>H6. Infinite Family of Pairwise Disjoint Infinite Subsets of ‚Ñï</h2>

    <p>Construct an infinite family \(\{A_n\}_{n\in\mathbb{N}}\) of subsets of \(\mathbb{N}\) such that:</p>
    <ol>
      <li>Each \(A_n\) is infinite.</li>
      <li>The sets are pairwise disjoint: if \(m\neq n\), then \(A_m\cap A_n = \varnothing\).</li>
      <li>Their union is all of \(\mathbb{N}\): \(\bigcup_{n\in\mathbb{N}} A_n = \mathbb{N}\).</li>
    </ol>

    <p><strong>(a)</strong> Give an explicit formula for each \(A_n\) (e.g. using arithmetic progressions or prime decompositions).</p>

    <p><strong>(b)</strong> Prove properties (1), (2), and (3) rigorously from your definition.</p>

    <div class="group-notes">
      <h3>Notes for H6</h3>
      <div class="note">Classic idea: partition ‚Ñï into infinite arithmetic progressions or ‚Äúcolumns‚Äù.</div>
      <textarea class="latex-input"
        placeholder="Define A‚ÇÄ, A‚ÇÅ, ‚Ä¶ explicitly and prove infinitude, disjointness, and union = ‚Ñï."></textarea>
      <div class="rendered-output"></div>
      <div class="controls">
        <button class="copy-btn">Copy H6 + notes</button>
      </div>
    </div>
    <div class="canvas-block">
      <div class="note">Canvas: visualize ‚Ñï as a grid and color different A‚Çô.</div>
      <div class="canvas-wrapper">
        <canvas class="note-canvas"></canvas>
      </div>
      <button class="copy-btn clear-canvas">Clear drawing</button>
    </div>
  </section>

  <!-- H7 -->
  <section class="problem-group" id="H7">
    <h2>H7. A Deep ‚ÄúZoo‚Äù of Relations on ‚Ñï</h2>

    <p>On \(\mathbb{N}\), define the following relations (you can modify them as long as they‚Äôre explicit):</p>
    <ol>
      <li>\(R_1\): \(\langle a,b\rangle\in R_1 \iff a\le b\).</li>
      <li>\(R_2\): \(\langle a,b\rangle\in R_2 \iff a-b\text{ is even}\).</li>
      <li>\(R_3\): \(\langle a,b\rangle\in R_3 \iff a\mid b\) (a divides b).</li>
      <li>\(R_4\): \(\langle a,b\rangle\in R_4 \iff a=b\text{ or }a=b+1\).</li>
      <li>\(R_5\): \(\langle a,b\rangle\in R_5 \iff |a-b|\le 1\).</li>
      <li>\(R_6\): \(\langle a,b\rangle\in R_6 \iff \max(a,b)\text{ is prime}\).</li>
    </ol>

    <p>For each \(R_i\):</p>
    <p><strong>(a)</strong> Determine whether it is reflexive, symmetric, and transitive.</p>
    <p><strong>(b)</strong> Determine whether it is an equivalence relation, an ordering relation (in the sense of the notes), both, or neither.</p>
    <p><strong>(c)</strong> For those that are equivalence relations, describe their equivalence classes. For those that are orders, describe informally the ‚Äúshape‚Äù of the order (chains, minimal elements, etc.).</p>
    <p><strong>(d)</strong> Summarize your findings in a table. Then explain which properties are ‚Äúcompatible‚Äù and which combinations cannot occur, based on the examples.</p>

    <div class="group-notes">
      <h3>Notes for H7</h3>
      <div class="note">Make a 6√ó4 property table: reflexive / symmetric / transitive / type.</div>
      <textarea class="latex-input"
        placeholder="Analyze each R·µ¢, then summarize compatibility patterns (e.g. equivalence vs order)."></textarea>
      <div class="rendered-output"></div>
      <div class="controls">
        <button class="copy-btn">Copy H7 + notes</button>
      </div>
    </div>
    <div class="canvas-block">
      <div class="note">Canvas: draw Hasse diagrams or equivalence-class pictures for the different R·µ¢.</div>
      <div class="canvas-wrapper">
        <canvas class="note-canvas"></canvas>
      </div>
      <button class="copy-btn clear-canvas">Clear drawing</button>
    </div>
  </section>

  <!-- H8 -->
  <section class="problem-group" id="H8">
    <h2>H8. Injective Self-Map on ‚Ñï and an Invariant Subset</h2>

    <p>Let \(f:\mathbb{N}\to\mathbb{N}\) be an <strong>injective</strong> function (but not assumed surjective).</p>

    <p><strong>(a)</strong> For each \(n\in\mathbb{N}\), consider the <strong>forward orbit</strong>:
      \[
      \mathcal{O}(n) = \{f^k(n)\mid k\in\mathbb{N}\}
      \]
      (where \(f^0(n)=n\), and \(f^{k+1}(n) = f(f^k(n))\)).
      Prove that if \(f^k(n)=f^m(n)\) with \(k&lt;m\), then the orbit \(\mathcal{O}(n)\) is eventually periodic (i.e. there is a cycle).
    </p>

    <p><strong>(b)</strong> Show that the orbits \(\mathcal{O}(n)\) for different \(n\) are either identical or disjoint.</p>

    <p><strong>(c)</strong> Using the orbits, construct a subset \(S\subseteq\mathbb{N}\) such that the restriction \(f\upharpoonright S: S\to S\) is a <strong>bijection</strong>.<br>
      (You are allowed to pick one representative from each orbit in some systematic way.)
    </p>

    <div class="group-notes">
      <h3>Notes for H8</h3>
      <div class="note">Think of the directed graph of f: chains into cycles; pick one point per orbit.</div>
      <textarea class="latex-input"
        placeholder="Analyze orbit structure, prove disjoint-or-same, then define S so f|S is bijective."></textarea>
      <div class="rendered-output"></div>
      <div class="controls">
        <button class="copy-btn">Copy H8 + notes</button>
      </div>
    </div>
    <div class="canvas-block">
      <div class="note">Canvas: orbit/cycle diagrams of an injective map on ‚Ñï.</div>
      <div class="canvas-wrapper">
        <canvas class="note-canvas"></canvas>
      </div>
      <button class="copy-btn clear-canvas">Clear drawing</button>
    </div>
  </section>

  <!-- H9 -->
  <section class="problem-group" id="H9">
    <h2>H9. Encodings of Tuples as Functions</h2>

    <p>
      In the notes, tuples like \(\langle x_1,\dots,x_n\rangle\) are built recursively from ordered pairs.
      Another approach: view a tuple as a <strong>function</strong> from an initial segment of \(\mathbb{N}\) into a set.
      Let \(A\) be a set.
    </p>

    <p><strong>(a)</strong> Define precisely what it means to regard an \(n\)-tuple \(\langle x_1,\dots,x_n\rangle\) of elements of \(A\) as a function \(t:\{1,\dots,n\}\to A\).</p>

    <p><strong>(b)</strong> Prove that two \(n\)-tuples \(\langle x_1,\dots,x_n\rangle\) and \(\langle y_1,\dots,y_n\rangle\) are equal (as tuples in the sense of the PDF) if and only if the corresponding functions \(t_x\) and \(t_y\) are equal (as relations/functions in the sense of the PDF).</p>

    <p><strong>(c)</strong> Use this viewpoint to give an alternative definition of the Cartesian power \(A^n\) and prove that it is equivalent to the one in the notes.</p>

    <div class="group-notes">
      <h3>Notes for H9</h3>
      <div class="note">Connect ‚Äútuple as nested pairs‚Äù with ‚Äútuple as function from {1,‚Ä¶,n}‚Äù.</div>
      <textarea class="latex-input"
        placeholder="Spell out the identification between sequences and functions; then define A‚Åø via functions."></textarea>
      <div class="rendered-output"></div>
      <div class="controls">
        <button class="copy-btn">Copy H9 + notes</button>
      </div>
    </div>
    <div class="canvas-block">
      <div class="note">Canvas: draw mapping diagrams from {1,‚Ä¶,n} to A for tuples.</div>
      <div class="canvas-wrapper">
        <canvas class="note-canvas"></canvas>
      </div>
      <button class="copy-btn clear-canvas">Clear drawing</button>
    </div>
  </section>

  <!-- H10 -->
  <section class="problem-group" id="H10">
    <h2>H10. A Nonstandard Strict Order on ‚Ñ§</h2>

    <p>Define a relation \(\prec\) on \(\mathbb{Z}\) by:
      \[
      a\prec b \iff \big(|a| &lt; |b|\big)\ \text{or}\ \big(|a|=|b|\text{ and }a&lt;b\big).
      \]
      So we order integers by increasing absolute value, breaking ties by the usual &lt;.
    </p>

    <p><strong>(a)</strong> Prove that \(\prec\) is a strict ordering relation on \(\mathbb{Z}\) (in the sense of the notes: transitive, trichotomy, etc.).</p>

    <p><strong>(b)</strong> Write the first 15 integers in increasing order under \(\prec\).</p>

    <p><strong>(c)</strong> Compare this order with the usual order &lt; on \(\mathbb{Z}\). Explain one way in which they behave similarly, and one way in which they differ dramatically.</p>

    <div class="group-notes">
      <h3>Notes for H10</h3>
      <div class="note">This is the ‚Äúby absolute value, then sign‚Äù order. Lay out examples.</div>
      <textarea class="latex-input"
        placeholder="Prove trichotomy + transitivity, then list the sequence, and compare to usual order."></textarea>
      <div class="rendered-output"></div>
      <div class="controls">
        <button class="copy-btn">Copy H10 + notes</button>
      </div>
    </div>
    <div class="canvas-block">
      <div class="note">Canvas: place integers on a number line by |¬∑| order to visualize ‚â∫.</div>
      <div class="canvas-wrapper">
        <canvas class="note-canvas"></canvas>
      </div>
      <button class="copy-btn clear-canvas">Clear drawing</button>
    </div>
  </section>

  <!-- H11 -->
  <section class="problem-group" id="H11">
    <h2>H11. Designing an Equivalence on ‚Ñ§ via an Iterated Operation</h2>

    <p>Define a function \(g:\mathbb{Z}\to\mathbb{Z}\) by \(g(n)=\lfloor n/2\rfloor\) (integer division by 2).
      Define a relation \(\sim\) on \(\mathbb{Z}\) by:
      \[
      a\sim b \iff \text{there exists }k\in\mathbb{N}\text{ such that } g^k(a)=g^k(b),
      \]
      where \(g^k\) is the \(k\)-fold composition of \(g\) with itself.
    </p>

    <p><strong>(a)</strong> Prove that \(\sim\) is an equivalence relation on \(\mathbb{Z}\).</p>

    <p><strong>(b)</strong> Describe the equivalence class \([n]\) in terms of the binary expansion of \(n\) (you don‚Äôt need full binary theory; informal reasoning is fine as long as you can justify the pattern via division by 2).</p>

    <p><strong>(c)</strong> Argue that the set of equivalence classes is infinite.</p>

    <div class="group-notes">
      <h3>Notes for H11</h3>
      <div class="note">Think: repeatedly halving numbers eventually chops off lower bits of binary expansion.</div>
      <textarea class="latex-input"
        placeholder="Show reflexive/symmetric/transitive for ‚àº, then describe classes via eventual halving behavior."></textarea>
      <div class="rendered-output"></div>
      <div class="controls">
        <button class="copy-btn">Copy H11 + notes</button>
      </div>
    </div>
    <div class="canvas-block">
      <div class="note">Canvas: orbit trees under n ‚Ü¶ ‚åän/2‚åã for sample integers.</div>
      <div class="canvas-wrapper">
        <canvas class="note-canvas"></canvas>
      </div>
      <button class="copy-btn clear-canvas">Clear drawing</button>
    </div>
  </section>

  <!-- H12 -->
  <section class="problem-group" id="H12">
    <h2>H12. A Monster Problem: Set Families, Equivalence, and Functions at Once</h2>

    <p>
      Let \(\mathcal{F}\) be the set of all <strong>infinite</strong> subsets of \(\mathbb{N}\). Consider the following:
    </p>
    <ul>
      <li>For \(A,B\in\mathcal{F}\), define \(A\preceq B\) if \(A\subseteq B\).</li>
      <li>
        Define an equivalence relation \(\approx\) on \(\mathcal{F}\) by:
        \[
        A\approx B \iff A\Delta B\text{ is finite}
        \]
        (as in H5).
      </li>
      <li>Let \(\mathcal{F}/\approx\) be the set of equivalence classes.</li>
    </ul>

    <p><strong>(a)</strong> Prove that every equivalence class in \(\mathcal{F}/\approx\) contains infinitely many different subsets of \(\mathbb{N}\).</p>

    <p><strong>(b)</strong> Define a function
      \[
      \Phi:\mathcal{F}/\approx \to \mathcal{P}(\mathbb{N}),\quad \Phi([A]) = \{n\in\mathbb{N}\mid n\in A\text{ for all but finitely many }A'\in [A]\}
      \]
      (where you have to make precise what ‚Äúfor all but finitely many \(A'\in [A]\)‚Äù means in terms of subsets and quantifiers).
      Explain why this map is well-defined (i.e. does not depend on the choice of representative \(A\) in the class \([A]\)).
    </p>

    <p><strong>(c)</strong> Discuss informally whether you expect \(\Phi\) to be injective, surjective, both, or neither, and justify your expectation using only the notions introduced in the PDF (sets, families, equivalence, power sets, functions).</p>

    <div class="group-notes">
      <h3>Notes for H12</h3>
      <div class="note">Heavy: combine ‚Äúalmost equality‚Äù, infinite families, and a class-level map Œ¶.</div>
      <textarea class="latex-input"
        placeholder="Formalize 'all but finitely many', prove Œ¶ is well-defined, and explore injective/surjective heuristics."></textarea>
      <div class="rendered-output"></div>
      <div class="controls">
        <button class="copy-btn">Copy H12 + notes</button>
      </div>
    </div>
    <div class="canvas-block">
      <div class="note">Canvas: sketch equivalence classes in ùí´(‚Ñï) and how Œ¶ reads their ‚Äúlimit behavior‚Äù.</div>
      <div class="canvas-wrapper">
        <canvas class="note-canvas"></canvas>
      </div>
      <button class="copy-btn clear-canvas">Clear drawing</button>
    </div>
  </section>
</main>


  <!-- Root for the React symbol popup -->
  <div id="symbol-popup-root"></div>

  <!-- React + ReactDOM + Babel (for JSX in this example) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- React + JSX: ONLY the popup component + showSymbolPopup -->
  <script type="text/babel" data-presets="env,react">
    // ---------- Symbol data (you can expand this later) ----------
    window.SYMBOLS = [];
    window.RECENT_SYMBOLS = [];

    // ---------- Simple search ----------
    function searchSymbols(symbols, query) {
      const q = query.trim().toLowerCase();

      const recentList = Array.isArray(window.RECENT_SYMBOLS)
        ? window.RECENT_SYMBOLS
        : [];
      const recentSet = new Set(recentList);

      // ---------- Case 1: empty query ‚Üí show recent first ----------
      if (!q) {
        const seen = new Set();
        const recent = [];
        const others = [];

        // 1) Put recents first, in recency order
        for (const latex of recentList) {
          const sym = symbols.find((s) => s.latex === latex);
          if (sym && !seen.has(sym.latex)) {
            recent.push(sym);
            seen.add(sym.latex);
          }
        }

        // 2) Then all other symbols, sorted by priority
        for (const s of symbols) {
          if (!seen.has(s.latex)) {
            others.push(s);
          }
        }

        others.sort((a, b) => (b.priority || 0) - (a.priority || 0));

        return [...recent, ...others].slice(0, 20);
      }

      // ---------- Case 2: non-empty query ‚Üí scoring with recency boost ----------
      return symbols
        .map((s) => {
          const haystack = [
            s.label,
            s.latex,
            ...(s.keywords || []),
            ...(s.categories || [])
          ].join(" ").toLowerCase();

          if (!haystack.includes(q)) return null;

          let score = s.priority || 0;

          // Strong boost if this is a recent symbol
          const recIndex = recentList.indexOf(s.latex);
          if (recIndex !== -1) {
            const recencyWeight = 1.0 + (recentList.length - recIndex) * 0.05;
            score += recencyWeight;
          }

          if (s.latex.toLowerCase().startsWith("\\" + q)) score += 0.7;
          if ((s.keywords || []).some((k) => k.toLowerCase() === q)) score += 0.5;
          if (s.label.toLowerCase() === q) score += 0.4;

          const idx = haystack.indexOf(q);
          if (idx >= 0) score += Math.max(0, 0.3 - idx / 50);

          return { s, score };
        })
        .filter(Boolean)
        .sort((a, b) => b.score - a.score)
        .map((x) => x.s)
        .slice(0, 20);
    }


    // ---------- React popup component ----------
    const SymbolPopup = ({ x, y, initialQuery = "", onSelect, onClose }) => {
        const [query, setQuery] = React.useState("");
        const [highlightIndex, setHighlightIndex] = React.useState(0);
        const containerRef = React.useRef(null);
        const inputRef = React.useRef(null);

        const results = React.useMemo(
          () => searchSymbols(window.SYMBOLS || [], query),
          [query]
        );

        React.useEffect(() => {
          if (inputRef.current) {
            setTimeout(() => inputRef.current.focus(), 0);
          }
        }, []);

      React.useEffect(() => {
        if (inputRef.current) {
          setTimeout(() => inputRef.current.focus(), 0);
        }
      }, []);

      React.useEffect(() => {
        function handleClickOutside(e) {
          if (!containerRef.current) return;
          if (!containerRef.current.contains(e.target)) {
            onClose();
          }
        }
        document.addEventListener("mousedown", handleClickOutside);
        return () => document.removeEventListener("mousedown", handleClickOutside);
      }, [onClose]);

      const handleKeyDown = (e) => {
        const count = results.length;
        if (e.key === "ArrowDown") {
          e.preventDefault();
          if (count === 0) return;
          setHighlightIndex((prev) => (prev + 1) % count);
        } else if (e.key === "ArrowUp") {
          e.preventDefault();
          if (count === 0) return;
          setHighlightIndex((prev) => (prev - 1 + count) % count);
        } else if (e.key === "Enter") {
          e.preventDefault();
          if (count === 0) return;
          onSelect(results[highlightIndex]);
        } else if (e.key === "Escape") {
          e.preventDefault();
          onClose();
        }
      };

      return (
        <div
          ref={containerRef}
          style={{
            position: "absolute",
            left: x,
            top: y,
            zIndex: 9999,
            minWidth: 260,
            maxWidth: 360,
            background: "#fff",
            border: "1px solid #ddd",
            borderRadius: 6,
            boxShadow: "0 8px 24px rgba(0,0,0,0.12)",
            padding: 8,
            fontFamily:
              'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif',
            fontSize: 13
          }}
        >
          <input
            ref={inputRef}
            value={query}
            onChange={(e) => {
              setQuery(e.target.value);
              setHighlightIndex(0);
            }}
            onKeyDown={handleKeyDown}
            placeholder="Search symbol or LaTeX‚Ä¶"
            style={{
              width: "100%",
              boxSizing: "border-box",
              padding: "4px 6px",
              marginBottom: 6,
              borderRadius: 4,
              border: "1px solid #ccc",
              outline: "none"
            }}
          />

          <div style={{ maxHeight: 260, overflowY: "auto" }}>
            {results.map((sym, idx) => (
              <div
                key={sym.latex + idx}
                style={{
                  display: "flex",
                  alignItems: "center",
                  padding: "4px 6px",
                  borderRadius: 4,
                  background: idx === highlightIndex ? "#eef3ff" : "transparent",
                  cursor: "pointer"
                }}
                onMouseDown={(e) => {
                  e.preventDefault();
                  onSelect(sym);
                }}
              >
                <span
                  style={{
                    width: 32,
                    textAlign: "center",
                    fontSize: 18,
                    marginRight: 6
                  }}
                >
                  {sym.label}
                </span>
                <div
                  style={{
                    display: "flex",
                    flexDirection: "column",
                    flex: 1,
                    overflow: "hidden"
                  }}
                >
                  <span
                    style={{
                      fontFamily: "monospace",
                      fontSize: 12,
                      whiteSpace: "nowrap",
                      overflow: "hidden",
                      textOverflow: "ellipsis"
                    }}
                  >
                    {sym.latex}
                  </span>
                  {sym.keywords && sym.keywords.length > 0 && (
                    <span
                      style={{
                        fontSize: 11,
                        color: "#777",
                        whiteSpace: "nowrap",
                        overflow: "hidden",
                        textOverflow: "ellipsis"
                      }}
                    >
                      {sym.keywords.slice(0, 4).join(", ")}
                    </span>
                  )}
                </div>
              </div>
            ))}

            {results.length === 0 && (
              <div
                style={{
                  padding: "4px 6px",
                  fontSize: 12,
                  color: "#888"
                }}
              >
                No matches
              </div>
            )}
          </div>
        </div>
      );
    };

    // ---------- Helper: show popup from vanilla JS ----------
    const popupRoot = ReactDOM.createRoot(
      document.getElementById("symbol-popup-root")
    );

    window.showSymbolPopup = function ({ x, y, initialQuery, onSelect }) {
      const handleSelect = (symbol) => {
        // --- Update recent list (per session, in-memory) ---
        if (!Array.isArray(window.RECENT_SYMBOLS)) {
          window.RECENT_SYMBOLS = [];
        }
        const arr = window.RECENT_SYMBOLS;
        const latex = symbol.latex;

        // Remove if already present
        const existingIndex = arr.indexOf(latex);
        if (existingIndex !== -1) {
          arr.splice(existingIndex, 1);
        }
        // Add to front
        arr.unshift(latex);
        // Keep list bounded (e.g. last 30 unique symbols)
        if (arr.length > 30) {
          arr.length = 30;
        }

        // Pass selection back to caller (inserts in textarea, etc.)
        onSelect(symbol);

        // Close popup
        popupRoot.render(null);
      };

      const handleClose = () => {
        popupRoot.render(null);
      };

      popupRoot.render(
        <SymbolPopup
          x={x}
          y={y}
          initialQuery={initialQuery}
          onSelect={handleSelect}
          onClose={handleClose}
        />
      );
    };

  </script>

  <!-- Plain JS: MathJax rendering, copy, canvas, backslash trigger -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Load symbols.json
      fetch("../../symbols.json")
        .then((res) => res.json())
        .then((data) => {
          window.SYMBOLS = Array.isArray(data) ? data : (data.symbols || []);
          console.log("Loaded symbols:", window.SYMBOLS.length);
        })
        .catch((err) => {
          console.error("Failed to load symbols.json", err);
          window.SYMBOLS = [];
        });

      function renderBlockTeX(textarea, outputElement) {
        const raw = textarea.value.trim();
        if (!raw) {
          if (outputElement) outputElement.innerHTML = "";
          return;
        }

        let tex = raw;
        const explicitDisplayOrEnv = /^(\$\$|\\\[|\\begin\{)/.test(raw);
        const looksMultiline = raw.includes("\\\\") || raw.includes("\n");

        if (!explicitDisplayOrEnv) {
          if (looksMultiline) {
            tex = "\\begin{gather*}\n" + raw + "\n\\end{gather*}";
          } else {
            tex = "\\[" + raw + "\\]";
          }
        }

        if (!outputElement) return;
        outputElement.textContent = tex;

        if (window.MathJax && MathJax.typesetPromise) {
          MathJax.typesetPromise([outputElement]).catch((err) =>
            console.error(err)
          );
        }
      }

      function insertAtCursor(textarea, text) {
        if (!textarea) return;
        const start = textarea.selectionStart != null ? textarea.selectionStart : textarea.value.length;
        const end   = textarea.selectionEnd != null ? textarea.selectionEnd : textarea.value.length;
        const value = textarea.value;

        textarea.value = value.slice(0, start) + text + value.slice(end);
        const newPos = start + text.length;

        textarea.focus();
        textarea.selectionStart = textarea.selectionEnd = newPos;
        textarea.dispatchEvent(new Event("input", { bubbles: true }));
      }

      // ---------- Notes textareas ----------
      const allTextareas = document.querySelectorAll(".latex-input");

      // ========================================================
      // Opens the popup based on the textarea cursor position
      // ========================================================
      function openPopupAtTextareaCursor(ta) {
        const rect = ta.getBoundingClientRect();
        const x = rect.left + window.scrollX + 40;
        const y = rect.top + window.scrollY + 20;

        const pos = ta.selectionStart != null ? ta.selectionStart : ta.value.length;
        const value = ta.value;

        let initialQuery = "";
        const lastBackslash = value.lastIndexOf("\\", pos - 1);
        if (lastBackslash !== -1 && lastBackslash < pos) {
          initialQuery = value.slice(lastBackslash + 1, pos);
        }

        if (window.showSymbolPopup) {
          window.showSymbolPopup({
            x,
            y,
            initialQuery,
            onSelect(symbol) {
              insertAtCursor(ta, symbol.latex);
            }
          });
        }
      }

      allTextareas.forEach((ta) => {
        // Live render on input
        ta.addEventListener("input", () => {
          const box = ta.closest(".group-notes");
          if (!box) return;
          const out = box.querySelector(".rendered-output");
          renderBlockTeX(ta, out);
        });

        let lastBackslashTime = 0;

        ta.addEventListener("keydown", (e) => {
          if (e.key === "\\") {
            const now = Date.now();

            // Rapid double press ‚Üí treat as shortcut
            if (now - lastBackslashTime < 250) {
              e.preventDefault(); // don't type this second "\"

              // üî• Remove the *previous* "\" that was just typed
              const pos = ta.selectionStart != null ? ta.selectionStart : ta.value.length;
              const value = ta.value;

              if (pos > 0 && value[pos - 1] === "\\") {
                ta.value = value.slice(0, pos - 1) + value.slice(pos);
                ta.selectionStart = ta.selectionEnd = pos - 1;
                // re-render after change
                ta.dispatchEvent(new Event("input", { bubbles: true }));
              }

              // Open the popup at the cursor
              openPopupAtTextareaCursor(ta);
              lastBackslashTime = 0; // reset
              return;
            }

            // First "\" ‚Üí let it type normally
            lastBackslashTime = now;
          }
        });

        // Optional: initial render
        const box = ta.closest(".group-notes");
        if (box) {
          const out = box.querySelector(".rendered-output");
          renderBlockTeX(ta, out);
        }
      });



      // ---------- Copy buttons ----------
      const noteGroups = document.querySelectorAll(".group-notes");
      noteGroups.forEach((group) => {
        const section  = group.closest(".problem-group");
        const textarea = group.querySelector(".latex-input");
        const button   = group.querySelector(".copy-btn");

        if (!button || !textarea || !section) return;

        button.addEventListener("click", async () => {
          const problems = Array.from(
            section.querySelectorAll(":scope > p")
          ).map((p) => p.textContent.trim());

          const problemBlock =
            "Problems:\n" +
            problems.map((t, i) => `${i + 1}. ${t}`).join("\n") +
            "\n\n";

          const latex = textarea.value.trim();
          const notesBlock = "Notes (LaTeX):\n" + latex + "\n";

          const combined = problemBlock + notesBlock;

          try {
            await navigator.clipboard.writeText(combined);
            button.classList.add("copied");
            setTimeout(() => button.classList.remove("copied"), 1200);
          } catch (err) {
            console.error("Clipboard error:", err);
            alert("Copy failed ‚Äì your browser may block clipboard access.");
          }
        });
      });

      // ---------- Drawing canvases ----------
      const canvases = document.querySelectorAll(".note-canvas");
      canvases.forEach((canvas) => {
        const ctx = canvas.getContext("2d");
        const clearBtn = canvas.closest(".canvas-block").querySelector(".clear-canvas");

        function resizeCanvas() {
          const rect = canvas.getBoundingClientRect();
          const dpr = window.devicePixelRatio || 1;

          canvas.width  = rect.width * dpr;
          canvas.height = rect.height * dpr;

          ctx.setTransform(1, 0, 0, 1, 0, 0);
          ctx.scale(dpr, dpr);

          ctx.lineCap = "round";
          ctx.lineJoin = "round";
          ctx.lineWidth = 2;
        }

        resizeCanvas();
        window.addEventListener("resize", resizeCanvas);

        let drawing = false;
        let lastX = 0;
        let lastY = 0;

        function getPos(evt) {
          const rect = canvas.getBoundingClientRect();
          if (evt.touches && evt.touches[0]) {
            return {
              x: evt.touches[0].clientX - rect.left,
              y: evt.touches[0].clientY - rect.top
            };
          } else {
            return {
              x: evt.clientX - rect.left,
              y: evt.clientY - rect.top
            };
          }
        }

        function startDraw(evt) {
          evt.preventDefault();
          drawing = true;
          const pos = getPos(evt);
          lastX = pos.x;
          lastY = pos.y;
        }

        function draw(evt) {
          if (!drawing) return;
          evt.preventDefault();
          const pos = getPos(evt);
          ctx.beginPath();
          ctx.moveTo(lastX, lastY);
          ctx.lineTo(pos.x, pos.y);
          ctx.stroke();
          lastX = pos.x;
          lastY = pos.y;
        }

        function endDraw(evt) {
          if (!drawing) return;
          evt.preventDefault();
          drawing = false;
        }

        canvas.addEventListener("mousedown", startDraw);
        canvas.addEventListener("mousemove", draw);
        window.addEventListener("mouseup", endDraw);

        canvas.addEventListener("touchstart", startDraw, { passive: false });
        canvas.addEventListener("touchmove", draw, { passive: false });
        canvas.addEventListener("touchend", endDraw, { passive: false });
        canvas.addEventListener("touchcancel", endDraw, { passive: false });

        if (clearBtn) {
          clearBtn.addEventListener("click", () => {
            const rect = canvas.getBoundingClientRect();
            ctx.clearRect(0, 0, rect.width, rect.height);
          });
        }
      });
    });
  </script>

</body>
</html>