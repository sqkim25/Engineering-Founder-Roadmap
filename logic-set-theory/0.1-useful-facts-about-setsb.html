<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sets – Practice Page</title>

  <!-- Basic layout styles -->
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
                   sans-serif;
      line-height: 1.5;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }

    header {
      background: #222;
      color: #fff;
      padding: 1rem 1.5rem;
    }

    header h1 {
      margin: 0;
      font-size: 1.6rem;
    }

    main {
      max-width: 900px;
      margin: 1.5rem auto 3rem;
      padding: 0 1rem 2rem;
      background: #fff;
      box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.08);
      border-radius: 8px;
    }

    section {
      margin-bottom: 2rem;
    }

    h2 {
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
      font-size: 1.3rem;
    }

    .pdf-wrapper {
      border: 1px solid #ccc;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 1.5rem;
    }

    .note {
      font-size: 0.9rem;
      color: #555;
      margin-bottom: 0.8rem;
    }

    .latex-input {
      width: 100%;
      min-height: 70px;
      padding: 0.5rem;
      font-family: "Fira Code", "JetBrains Mono", Menlo, Monaco,
                   Consolas, "Courier New", monospace;
      font-size: 0.95rem;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      resize: vertical;
      margin-bottom: 0.5rem;
    }

    .rendered-output {
      min-height: 2rem;
      padding: 0.5rem;
      border-radius: 4px;
      border: 1px dashed #ccc;
      background: #fafafa;
      margin-bottom: 0.5rem;
      text-align: center;
    }

    .rendered-output mjx-container,
    #note-render mjx-container {
      display: inline-block;
      margin-left: auto;
      margin-right: auto;
    }

    .controls {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-bottom: 0.3rem;
    }

    .copy-btn {
      padding: 0.3rem 0.7rem;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      background: #333;
      color: #fff;
      font-size: 0.9rem;
    }

    .copy-btn:active {
      transform: scale(0.97);
    }

    .copy-btn.copied::after {
      content: " ✓";
    }

    /* Note board styles */
    .note-board {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 0.75rem;
      background: #fafafa;
    }

    .note-board h3 {
      margin-top: 0;
      margin-bottom: 0.4rem;
      font-size: 1.1rem;
    }

    .note-section {
      margin-bottom: 1rem;
    }

    .canvas-wrapper {
      border: 1px solid #ccc;
      border-radius: 4px;
      overflow: hidden;
      background: #fff;
    }

    #note-canvas {
      display: block;
      width: 100%;
      height: 300px;
      touch-action: none; /* for better touch drawing */
    }

    #clear-canvas {
      margin-top: 0.4rem;
    }

    /* Center MathJax output */
    .rendered-output,
    #note-render {
      text-align: center;
    }

    /* Level links */
    .level-links {
      list-style: none;
      padding-left: 0;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 0.75rem;
      margin-top: 0.75rem;
    }

    .level-links li a {
      display: block;
      text-align: center;
      padding: 0.6rem 0.8rem;
      border-radius: 6px;
      text-decoration: none;
      background: #f0f0f0;
      color: #222;
      font-weight: 500;
      border: 1px solid #ddd;
      transition: background 0.15s ease, transform 0.1s ease,
                  box-shadow 0.15s ease;
    }

    .level-links li a:hover {
      background: #e4e4ff;
      box-shadow: 0 0.2rem 0.4rem rgba(0,0,0,0.08);
      transform: translateY(-1px);
    }

    .level-links li a:active {
      transform: translateY(0);
      box-shadow: none;
    }

    /* ------------------ Evan Chen–style theme for main content ------------------ */

    :root {
      --evan-red: #8C1515;
      --evan-blue: #1E3A8A;
      --evan-gray-bg: #f9f9fb;
      --evan-border: #e2e2e8;
    }

    /* Use Evan-like typography inside the main content area */
    main {
      font-family: "Palatino Linotype", "Book Antiqua", Palatino, serif;
      background: #ffffff;
    }

    main h1, main h2, main h3 {
      font-family: "Palatino Linotype", "Book Antiqua", Palatino, serif;
      font-weight: 700;
    }

    main h1 {
      font-size: 2.2rem;
      color: var(--evan-blue);
    }

    main h2 {
      font-size: 1.8rem;
      color: var(--evan-red);
    }

    main h3 {
      font-size: 1.4rem;
      color: var(--evan-blue);
    }

    /* Theorem-like boxes */
    .theorem, .definition, .lemma, .proposition, .remark {
      border-left: 4px solid var(--evan-red);
      background: var(--evan-gray-bg);
      padding: 0.85rem 1rem;
      margin: 1rem 0;
      border-radius: 4px;
      border: 1px solid var(--evan-border);
    }

    .remark {
      border-left-color: #666666;
    }

    .theorem-title,
    .definition-title,
    .lemma-title,
    .proposition-title,
    .remark-title {
      font-weight: 700;
      color: var(--evan-red);
      margin-bottom: 0.35rem;
      display: block;
    }

    .remark-title {
      color: #444;
    }

    .example {
      border-left: 4px solid var(--evan-blue);
      background: #eef2ff;
      padding: 0.85rem 1rem;
      margin: 1rem 0;
      border-radius: 4px;
      border: 1px solid #d8ddff;
    }

    .example-title {
      font-weight: 700;
      color: var(--evan-blue);
      margin-bottom: 0.35rem;
      display: block;
    }

    .evan-section h3 {
      margin-top: 1.4rem;
      margin-bottom: 0.4rem;
    }

    .evan-section p {
      margin: 0.3rem 0;
    }

    .evan-section ul {
      margin-top: 0.3rem;
      margin-bottom: 0.8rem;
    }
  </style>

  <!-- MathJax for LaTeX rendering -->
  <script>
    window.MathJax = {
      tex: {
        // include amsmath so align / align* / aligned etc. work
        packages: { "[+]": ["ams"] },
        inlineMath: [["\\(","\\)"], ["$","$"]],
        displayMath: [["\\[","\\]"], ["$$","$$"]]
      },
      svg: { fontCache: "global" }
    };
  </script>

  <script id="MathJax-script"
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"
          async></script>
</head>
<body>
  <header>
    <h1>Sets – Beamer Slides &amp; Problem Set</h1>
  </header>

  <main>
    <!-- REPLACED PDF VIEWER WITH DIRECT TEXT CONTENT -->
    <section>
      <h2>Chapter X – Useful Facts About Sets</h2>

      <div class="evan-section">
        <!-- I. Preliminaries and Notation -->
        <h3>I. Preliminaries and Notation</h3>

        <div class="remark">
          <span class="remark-title">Remark (Standard abbreviations).</span>
          <p>Throughout this chapter we use several common abbreviations:</p>
          <ul>
            <li>End of proof is indicated by a symbol such as \(\square\).</li>
            <li>“If \(\dots\), then \(\dots\)” may be written as \(P \Rightarrow Q\).</li>
            <li>The converse implication is written \(Q \Leftarrow P\).</li>
            <li>“If and only if” is abbreviated as “iff”, or \(P \Leftrightarrow Q\).</li>
            <li>“Therefore” may be written as \(\therefore\).</li>
          </ul>
        </div>

        <div class="remark">
          <span class="remark-title">Remark (Negation rule).</span>
          <p>We apply negation directly to symbols:</p>
          <p>\[
          x = y \quad\Longrightarrow\quad x \neq y,
          \qquad
          x \in A \quad\Longrightarrow\quad x \notin A.
          \]</p>
          <p>This convention extends to any symbol introduced later. For example, once
          \(\Sigma \models \tau\) is defined, its negation is written \(\Sigma \not\models \tau\).</p>
        </div>

        <!-- II. Sets and the Extensionality Principle -->
        <h3>II. Sets and the Extensionality Principle</h3>

        <div class="definition">
          <span class="definition-title">Definition 1 (Set).</span>
          <p>A <em>set</em> is a collection of objects, called its <em>elements</em>. We use</p>
          <p>\[
          t \in A,\quad t \notin A,\quad x = y
          \]</p>
          <p>to indicate membership, non-membership, and equality of names, respectively.</p>
        </div>

        <div class="remark">
          <span class="remark-title">Remark.</span>
          <p>If \(A = B\), then for every object \(t\),</p>
          <p>\[
          t \in A \iff t \in B.
          \]</p>
        </div>

        <div class="proposition">
          <span class="proposition-title">Proposition 1 (Extensionality).</span>
          <p>If \(A\) and \(B\) are sets such that</p>
          <p>\[
          \forall t \;\bigl( t \in A \iff t \in B \bigr),
          \]</p>
          <p>then \(A = B\).</p>
        </div>

        <div class="remark">
          <span class="remark-title">Remark.</span>
          <p>This expresses the idea that a set is completely determined by its members.</p>
        </div>

        <!-- III. Basic Constructions -->
        <h3>III. Basic Constructions</h3>

        <div class="definition">
          <span class="definition-title">Definition 2 (Adjoining an element).</span>
          <p>For any set \(A\) and any object \(t\), define</p>
          <p>\[
          A ; t \coloneqq A \cup \{t\}.
          \]</p>
          <p>This is the set whose elements are the elements of \(A\), together with the (possibly new) element \(t\).</p>
        </div>

        <div class="proposition">
          <span class="proposition-title">Proposition.</span>
          <p>For any set \(A\) and any object \(t\),</p>
          <p>\[
          t \in A \iff A ; t = A.
          \]</p>
        </div>

        <!-- IV. Common Sets and Notation -->
        <h3>IV. Common Sets and Notation</h3>

        <div class="definition">
          <span class="definition-title">Definition 3 (Special sets).</span>
          <ul>
            <li>The <em>empty set</em> \(\varnothing\) is the set with no elements.</li>
            <li>For any object \(x\), the <em>singleton</em> \(\{x\}\) is the set whose only element is \(x\).</li>
            <li>For any finite list of objects \(x_1,\dots,x_n\), the set
              \[
              \{x_1,\dots,x_n\}
              \]
              has exactly those objects as elements.
            </li>
          </ul>
        </div>

        <div class="remark">
          <span class="remark-title">Remark.</span>
          <p>For any objects \(x,y\),</p>
          <p>\[
          \{x,y\} = \{y,x\},
          \]</p>
          <p>since order does not matter for sets.</p>
        </div>

        <div class="definition">
          <span class="definition-title">Definition (Infinite sets).</span>
          <p>We use the standard notations</p>
          <p>\[
          \mathbb N = \{0,1,2,\dots\}
          \]</p>
          <p>for the set of natural numbers, and</p>
          <p>\[
          \mathbb Z = \{\dots,-2,-1,0,1,2,\dots\}
          \]</p>
          <p>for the set of all integers.</p>
        </div>

        <!-- V. Sets Specified by Properties -->
        <h3>V. Sets Specified by Properties</h3>

        <div class="definition">
          <span class="definition-title">Definition 4 (Set-builder notation).</span>
          <p>Given a property \(P(x)\), the set
          \[
          \{x \mid P(x)\}
          \]
          is the set of all objects \(x\) such that \(P(x)\) holds.</p>
        </div>

        <div class="example">
          <span class="example-title">Examples.</span>
          <ul>
            <li>\(\{x \in A \mid P(x)\}\) is the set of all elements \(x\) in \(A\) that satisfy \(P(x)\).</li>
            <li>\(\{\langle m,n\rangle \mid m < n \text{ in } \mathbb N\}\) is the set of all ordered pairs of natural numbers where the first component is smaller than the second.</li>
          </ul>
        </div>

        <!-- VI. Subsets and Power Sets -->
        <h3>VI. Subsets and Power Sets</h3>

        <div class="definition">
          <span class="definition-title">Definition 5 (Subset).</span>
          <p>A set \(A\) is a <em>subset</em> of a set \(B\), written \(A \subseteq B\), if</p>
          <p>\[
          \forall x\,(x \in A \implies x \in B).
          \]</p>
        </div>

        <div class="remark">
          <span class="remark-title">Remark.</span>
          <ul>
            <li>Every set is a subset of itself.</li>
            <li>\(\varnothing \subseteq A\) for every set \(A\); this is often called “vacuously true”.</li>
          </ul>
        </div>

        <div class="definition">
          <span class="definition-title">Definition 6 (Power set).</span>
          <p>For any set \(A\), the <em>power set</em> of \(A\) is</p>
          <p>\[
          \mathcal P(A) = \{x \mid x \subseteq A\},
          \]</p>
          <p>the set of all subsets of \(A\).</p>
        </div>

        <div class="example">
          <span class="example-title">Example.</span>
          <p>\[
          \mathcal P(\varnothing) = \{\varnothing\},
          \qquad
          \mathcal P(\{\varnothing\}) = \{\varnothing,\{\varnothing\}\}.
          \]</p>
        </div>

        <!-- VII. Union and Intersection -->
        <h3>VII. Union and Intersection</h3>

        <div class="definition">
          <span class="definition-title">Definition (Union and intersection).</span>
          <p>For sets \(A\) and \(B\), the <em>union</em> and <em>intersection</em> are defined by</p>
          <p>\[
          A \cup B = \{x \mid x \in A \text{ or } x \in B\},
          \]
          \[
          A \cap B = \{x \mid x \in A \text{ and } x \in B\}.
          \]</p>
        </div>

        <div class="definition">
          <span class="definition-title">Definition (Disjoint sets).</span>
          <p>Sets \(A\) and \(B\) are <em>disjoint</em> if</p>
          <p>\[
          A \cap B = \varnothing.
          \]</p>
        </div>

        <div class="definition">
          <span class="definition-title">Definition (Indexed unions and intersections).</span>
          <p>Let \(\mathcal A\) be a set whose elements are themselves sets. Then</p>
          <p>\[
          \bigcup \mathcal A = \{x \mid \exists S \in \mathcal A,\; x \in S\},
          \]
          \[
          \bigcap \mathcal A = \{x \mid \forall S \in \mathcal A,\; x \in S\}.
          \]</p>
        </div>

        <div class="example">
          <span class="example-title">Example.</span>
          <p>If
          \[
          \mathcal A = \{\{0,1,5\},\{1,6\},\{1,5\}\},
          \]
          then
          \[
          \bigcup \mathcal A = \{0,1,5,6\},
          \qquad
          \bigcap \mathcal A = \{1\}.
          \]</p>
        </div>

        <div class="remark">
          <span class="remark-title">Remark (Indexed family).</span>
          <p>When we have a family \((A_n)_{n \in \mathbb N}\) of sets indexed by natural numbers, we often write
          \[
          \bigcup_{n\in\mathbb N} A_n
          \]
          instead of \(\bigcup \{A_n \mid n \in \mathbb N\}\).</p>
        </div>

        <!-- VIII. Ordered Pairs and Sequences -->
        <h3>VIII. Ordered Pairs and Sequences</h3>

        <div class="definition">
          <span class="definition-title">Definition 7 (Ordered pair, Kuratowski).</span>
          <p>The <em>ordered pair</em> \(\langle x,y\rangle\) of objects \(x\) and \(y\) is defined by</p>
          <p>\[
          \langle x,y\rangle \coloneqq \{\{x\},\{x,y\}\}.
          \]</p>
        </div>

        <div class="proposition">
          <span class="proposition-title">Proposition (Basic property of ordered pairs).</span>
          <p>For any objects \(x,y,u,v\),</p>
          <p>\[
          \langle x,y\rangle = \langle u,v\rangle
          \quad\Longleftrightarrow\quad
          (x = u \text{ and } y = v).
          \]</p>
        </div>

        <div class="definition">
          <span class="definition-title">Definition 8 (\(n\)-tuples and finite sequences).</span>
          <p>Define \(n\)-tuples recursively by
          \[
          \langle x_1,\dots,x_{n+1}\rangle
          \coloneqq
          \big\langle \langle x_1,\dots,x_n\rangle, x_{n+1} \big\rangle
          \]
          for \(n \ge 1\). A <em>finite sequence</em> of members of a set \(A\) is an \(n\)-tuple
          \(\langle x_1,\dots,x_n\rangle\) with each \(x_i \in A\).</p>
        </div>

        <div class="definition">
          <span class="definition-title">Definition (Segments of a sequence).</span>
          <p>Let \(S = \langle x_1,\dots,x_n\rangle\) be a finite sequence. A <em>segment</em> of \(S\) is a finite sequence
          \[
          \langle x_k,\dots,x_m\rangle
          \]
          with \(1 \le k \le m \le n\). A segment is an <em>initial segment</em> if \(k = 1\). An initial segment is <em>proper</em> if it is different from \(S\).</p>
        </div>

        <div class="lemma">
          <span class="lemma-title">Lemma 0A.</span>
          <p>Suppose
          \[
          \langle x_1,\dots,x_m\rangle
          =
          \langle y_1,\dots,y_{m+k}\rangle
          \]
          for some \(m,k \ge 0\). Then
          \[
          x_1 = \langle y_1,\dots,y_{k+1}\rangle.
          \]</p>
        </div>

        <div class="remark">
          <span class="remark-title">Remark.</span>
          <p>The proof proceeds by induction on \(m\), using the definition of ordered pairs and the basic property of Kuratowski pairs.</p>
        </div>

        <div class="proposition">
          <span class="proposition-title">Corollary.</span>
          <p>Let \(A\) be a set such that no element of \(A\) is itself a finite sequence of other elements of \(A\). If
          \[
          \langle x_1,\dots,x_m\rangle = \langle y_1,\dots,y_n\rangle
          \]
          and all \(x_i,y_j\) belong to \(A\), then \(m = n\) and \(x_i = y_i\) for all \(1 \le i \le m\).</p>
        </div>

        <!-- IX. Cartesian Products and Relations -->
        <h3>IX. Cartesian Products and Relations</h3>

        <div class="definition">
          <span class="definition-title">Definition (Cartesian product).</span>
          <p>For sets \(A\) and \(B\), the <em>Cartesian product</em> \(A \times B\) is the set
          \[
          A \times B = \{\langle x,y\rangle \mid x \in A,\ y \in B\}.
          \]
          More generally, for a set \(A\) and integer \(n \ge 1\),
          \[
          A^n = \underbrace{A \times \cdots \times A}_{n\ \text{times}}
          \]
          is the set of all \(n\)-tuples of elements of \(A\).</p>
        </div>

        <div class="definition">
          <span class="definition-title">Definition (Binary relation).</span>
          <p>A <em>binary relation</em> \(R\) is a set of ordered pairs.</p>
        </div>

        <div class="example">
          <span class="example-title">Example.</span>
          <p>The strict ordering on the set \(\{0,1,2,3\}\) is represented by the relation
          \[
          \{\langle 0,1\rangle,\langle 0,2\rangle,\langle 0,3\rangle,
            \langle 1,2\rangle,\langle 1,3\rangle,\langle 2,3\rangle\}.
          \]</p>
        </div>

        <div class="definition">
          <span class="definition-title">Definition (Domain, range, and field).</span>
          <p>For a relation \(R\), the <em>domain</em> of \(R\) is
          \[
          \mathrm{dom}(R) = \{x \mid \exists y,\ \langle x,y\rangle \in R\},
          \]
          the <em>range</em> of \(R\) is
          \[
          \mathrm{ran}(R) = \{y \mid \exists x,\ \langle x,y\rangle \in R\},
          \]
          and the <em>field</em> of \(R\) is
          \[
          \mathrm{fld}(R) = \mathrm{dom}(R) \cup \mathrm{ran}(R).
          \]</p>
        </div>

        <div class="definition">
          <span class="definition-title">Definition (\(n\)-ary relation).</span>
          <p>Let \(A\) be a set. An <em>\(n\)-ary relation</em> on \(A\) is a subset of \(A^n\).</p>
          <ul>
            <li>When \(n = 1\), an \(n\)-ary relation is just a subset of \(A\) (a unary relation).</li>
            <li>When \(n \ge 2\), this recovers the usual notion of a relation of arity \(n\).</li>
          </ul>
          <p>The equality relation on \(A\) is the binary relation
          \[
          \{\langle x,x\rangle \mid x \in A\}.
          \]</p>
        </div>

        <div class="definition">
          <span class="definition-title">Definition (Restriction of a relation).</span>
          <p>Let \(R \subseteq A^n\) be an \(n\)-ary relation on \(A\) and let \(B \subseteq A\). The <em>restriction</em> of \(R\) to \(B\) is
          \[
          R \upharpoonright B \coloneqq R \cap B^n.
          \]</p>
        </div>

        <div class="example">
          <span class="example-title">Example.</span>
          <p>Let \(R\) be the usual strict order on \(\mathbb N\), and let \(B = \{0,1,2,3\}\). Then \(R \upharpoonright B\) is exactly the strict order relation on the set \(\{0,1,2,3\}\) shown earlier.</p>
        </div>

        <!-- X. Functions and Operations -->
        <h3>X. Functions and Operations</h3>

        <div class="definition">
          <span class="definition-title">Definition (Function).</span>
          <p>A relation \(F\) is a <em>function</em> if for each \(x \in \mathrm{dom}(F)\) there is exactly one \(y\) such that \(\langle x,y\rangle \in F\).</p>
          <p>We write
          \[
          F : A \to B
          \]
          to mean that \(F\) is a function with domain \(\mathrm{dom}(F) = A\) and range \(\mathrm{ran}(F) \subseteq B\).</p>
          <p>The function \(F\) <em>maps \(A\) onto \(B\)</em> (or is <em>surjective</em>) if \(\mathrm{ran}(F) = B\).</p>
          <p>The function \(F\) is <em>one-to-one</em> (or <em>injective</em>) if for each \(y \in \mathrm{ran}(F)\) there is exactly one \(x\) such that \(\langle x,y\rangle \in F\).</p>
        </div>

        <div class="definition">
          <span class="definition-title">Definition (\(n\)-ary operation).</span>
          <p>An <em>\(n\)-ary operation</em> on a set \(A\) is a function
          \[
          f : A^n \to A.
          \]</p>
        </div>

        <div class="example">
          <span class="example-title">Example.</span>
          <p>Addition is a binary operation on \(\mathbb N\), and the successor mapping \(S(n) = n+1\) is a unary operation on \(\mathbb N\).</p>
        </div>

        <div class="definition">
          <span class="definition-title">Definition (Restriction of an operation).</span>
          <p>Let \(f : A^n \to A\) be an \(n\)-ary operation on \(A\), and let \(B \subseteq A\). Define
          \[
          g \coloneqq f \cap (B^n \times A).
          \]
          Then \(g\) has domain \(B^n\), and
          \[
          g(b_1,\dots,b_n) = f(b_1,\dots,b_n)
          \]
          whenever \(b_1,\dots,b_n \in B\).</p>
        </div>

        <div class="proposition">
          <span class="proposition-title">Proposition (Closure criterion).</span>
          <p>The restriction \(g\) is itself an \(n\)-ary operation on \(B\) if and only if \(B\) is <em>closed under</em> \(f\); that is, whenever \(b_1,\dots,b_n \in B\), one has \(f(b_1,\dots,b_n) \in B\).</p>
        </div>

        <div class="example">
          <span class="example-title">Example.</span>
          <p>Consider addition on \(\mathbb R\). Its restriction to \(\mathbb N\) is the usual addition on \(\mathbb N\). The set \(\mathbb N\) is closed under this operation, so the restriction is again a binary operation on \(\mathbb N\).</p>
        </div>

        <!-- XI. Standard Classes of Relations -->
        <h3>XI. Standard Classes of Relations</h3>

        <div class="definition">
          <span class="definition-title">Definition (Basic properties).</span>
          <p>Let \(R\) be a relation on a set \(A\).</p>
          <ul>
            <li>\(R\) is <em>reflexive on \(A\)</em> if \(\langle x,x\rangle \in R\) for all \(x \in A\).</li>
            <li>\(R\) is <em>symmetric</em> if whenever \(\langle x,y\rangle \in R\), then \(\langle y,x\rangle \in R\).</li>
            <li>\(R\) is <em>transitive</em> if whenever \(\langle x,y\rangle \in R\) and \(\langle y,z\rangle \in R\), then \(\langle x,z\rangle \in R\).</li>
            <li>\(R\) satisfies <em>trichotomy on \(A\)</em> if for every \(x,y \in A\), exactly one of the following holds:
              \[
              \langle x,y\rangle \in R, \qquad x = y, \qquad \langle y,x\rangle \in R.
              \]
            </li>
          </ul>
        </div>

        <div class="definition">
          <span class="definition-title">Definition (Equivalence relation).</span>
          <p>A relation \(R\) on \(A\) is an <em>equivalence relation</em> on \(A\) if it is reflexive on \(A\), symmetric, and transitive.</p>
        </div>

        <div class="definition">
          <span class="definition-title">Definition (Ordering relation).</span>
          <p>A relation \(R\) on \(A\) is an <em>ordering relation</em> (or <em>strict order</em>) on \(A\) if it is transitive and satisfies trichotomy on \(A\).</p>
        </div>

        <!-- XII. Equivalence Classes -->
        <h3>XII. Equivalence Classes</h3>

        <div class="definition">
          <span class="definition-title">Definition (Equivalence class).</span>
          <p>Let \(R\) be an equivalence relation on a set \(A\). For each \(x \in A\), the <em>equivalence class</em> of \(x\) is
          \[
          [x] = \{y \in A \mid \langle x,y\rangle \in R\}.
          \]</p>
        </div>

        <div class="proposition">
          <span class="proposition-title">Proposition.</span>
          <ol>
            <li>The equivalence classes \([x]\) (for \(x \in A\)) form a partition of \(A\); that is, every element of \(A\) lies in at least one equivalence class, and no element lies in two distinct classes.</li>
            <li>For any \(x,y \in A\),
              \[
              [x] = [y] \iff \langle x,y\rangle \in R.
              \]
            </li>
          </ol>
        </div>
      </div>
    </section>

    <!-- NOTE-TAKING BOARD -->
    <section>
      <div class="note-board">
        <h3>Note-taking Board</h3>

        <!-- LaTeX note area -->
        <div class="note-section">
          <div class="note">
            Type LaTeX notes here. The preview updates automatically.
            Click in this box, then use the backslash shortcut to open the symbol popup.
          </div>
          <textarea id="note-latex"
                    class="latex-input"
                    placeholder="e.g. A \\setminus B = \\{x \\in A : x \\notin B\\}"></textarea>
          <div id="note-render" class="rendered-output"></div>
          <div class="controls">
            <button id="copy-notes" class="copy-btn">
              Copy notes (LaTeX)
            </button>
          </div>
        </div>

        <!-- Drawing pad -->
        <div class="note-section">
          <div class="note">
            Draw/write here (mouse or touch). Use “Clear” to reset.
          </div>
          <div class="canvas-wrapper">
            <canvas id="note-canvas"></canvas>
          </div>
          <button id="clear-canvas" class="copy-btn">
            Clear drawing
          </button>
        </div>
      </div>
    </section>

    <!-- LEVEL LINKS INSTEAD OF INLINE PROBLEMS -->
    <section>
      <h2>Problem Levels</h2>
      <p class="note">
        Choose a level to open its dedicated problem page.
        All level pages are stored in the <code>logic0-1</code> folder.
      </p>
      <ul class="level-links">
        <li><a href="logic0-1/level1.html">Level 1</a></li>
        <li><a href="logic0-1/level2.html">Level 2</a></li>
        <li><a href="logic0-1/level3.html">Level 3</a></li>
        <li><a href="logic0-1/level4.html">Level 4</a></li>
        <li><a href="logic0-1/level5.html">Level 5</a></li>
        <li><a href="logic0-1/level6.html">Level 6</a></li>
        <li><a href="logic0-1/level6plus.html">Level 6+</a></li>
      </ul>
    </section>
  </main>

  <!-- Root for the React symbol popup -->
  <div id="symbol-popup-root"></div>

  <!-- React + ReactDOM + Babel (for JSX popup) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- React + JSX: popup component + showSymbolPopup (same behavior as Logic Level 1) -->
  <script type="text/babel" data-presets="env,react">
    // ---------- Symbol data ----------
    window.SYMBOLS = [];
    window.RECENT_SYMBOLS = [];

    // ---------- Simple search ----------
    function searchSymbols(symbols, query) {
      const q = query.trim().lowerCase?.() ?? query.trim().toLowerCase();

      const recentList = Array.isArray(window.RECENT_SYMBOLS)
        ? window.RECENT_SYMBOLS
        : [];
      const recentSet = new Set(recentList);

      // ---------- Case 1: empty query → show recent first ----------
      if (!q) {
        const seen = new Set();
        const recent = [];
        const others = [];

        // 1) Put recents first, in recency order
        for (const latex of recentList) {
          const sym = symbols.find((s) => s.latex === latex);
          if (sym && !seen.has(sym.latex)) {
            recent.push(sym);
            seen.add(sym.latex);
          }
        }

        // 2) Then all other symbols, sorted by priority
        for (const s of symbols) {
          if (!seen.has(s.latex)) {
            others.push(s);
          }
        }

        others.sort((a, b) => (b.priority || 0) - (a.priority || 0));

        return [...recent, ...others].slice(0, 20);
      }

      // ---------- Case 2: non-empty query → scoring with recency boost ----------
      return symbols
        .map((s) => {
          const haystack = [
            s.label,
            s.latex,
            ...(s.keywords || []),
            ...(s.categories || [])
          ].join(" ").toLowerCase();

          if (!haystack.includes(q)) return null;

          let score = s.priority || 0;

          // Strong boost if this is a recent symbol
          const recIndex = recentList.indexOf(s.latex);
          if (recIndex !== -1) {
            const recencyWeight = 1.0 + (recentList.length - recIndex) * 0.05;
            score += recencyWeight;
          }

          if (s.latex.toLowerCase().startsWith("\\" + q)) score += 0.7;
          if ((s.keywords || []).some((k) => k.toLowerCase() === q)) score += 0.5;
          if (s.label.toLowerCase() === q) score += 0.4;

          const idx = haystack.indexOf(q);
          if (idx >= 0) score += Math.max(0, 0.3 - idx / 50);

          return { s, score };
        })
        .filter(Boolean)
        .sort((a, b) => b.score - a.score)
        .map((x) => x.s)
        .slice(0, 20);
    }


    const SymbolPopup = ({ x, y, initialQuery = "", onSelect, onClose }) => {
        const [query, setQuery] = React.useState("");
        const [highlightIndex, setHighlightIndex] = React.useState(0);
        const containerRef = React.useRef(null);
        const inputRef = React.useRef(null);

        const results = React.useMemo(
          () => searchSymbols(window.SYMBOLS || [], query),
          [query]
        );

        React.useEffect(() => {
          if (inputRef.current) {
            setTimeout(() => inputRef.current.focus(), 0);
          }
        }, []);


      React.useEffect(() => {
        function handleClickOutside(e) {
          if (!containerRef.current) return;
          if (!containerRef.current.contains(e.target)) {
            onClose();
          }
        }
        document.addEventListener("mousedown", handleClickOutside);
        return () => document.removeEventListener("mousedown", handleClickOutside);
      }, [onClose]);

      const handleKeyDown = (e) => {
        const count = results.length;
        if (e.key === "ArrowDown") {
          e.preventDefault();
          if (count === 0) return;
          setHighlightIndex((prev) => (prev + 1) % count);
        } else if (e.key === "ArrowUp") {
          e.preventDefault();
          if (count === 0) return;
          setHighlightIndex((prev) => (prev - 1 + count) % count);
        } else if (e.key === "Enter") {
          e.preventDefault();
          if (count === 0) return;
          onSelect(results[highlightIndex]);
        } else if (e.key === "Escape") {
          e.preventDefault();
          onClose();
        }
      };

      return (
        <div
          ref={containerRef}
          style={{
            position: "absolute",
            left: x,
            top: y,
            zIndex: 9999,
            minWidth: 260,
            maxWidth: 360,
            background: "#fff",
            border: "1px solid #ddd",
            borderRadius: 6,
            boxShadow: "0 8px 24px rgba(0,0,0,0.12)",
            padding: 8,
            fontFamily:
              'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif',
            fontSize: 13
          }}
        >
          <input
            ref={inputRef}
            value={query}
            onChange={(e) => {
              setQuery(e.target.value);
              setHighlightIndex(0);
            }}
            onKeyDown={handleKeyDown}
            placeholder="Search symbol or LaTeX…"
            style={{
              width: "100%",
              boxSizing: "border-box",
              padding: "4px 6px",
              marginBottom: 6,
              borderRadius: 4,
              border: "1px solid #ccc",
              outline: "none"
            }}
          />

          <div style={{ maxHeight: 260, overflowY: "auto" }}>
            {results.map((sym, idx) => (
              <div
                key={sym.latex + idx}
                style={{
                  display: "flex",
                  alignItems: "center",
                  padding: "4px 6px",
                  borderRadius: 4,
                  background: idx === highlightIndex ? "#eef3ff" : "transparent",
                  cursor: "pointer"
                }}
                onMouseDown={(e) => {
                  e.preventDefault();
                  onSelect(sym);
                }}
              >
                <span
                  style={{
                    width: 32,
                    textAlign: "center",
                    fontSize: 18,
                    marginRight: 6
                  }}
                >
                  {sym.label}
                </span>
                <div
                  style={{
                    display: "flex",
                    flexDirection: "column",
                    flex: 1,
                    overflow: "hidden"
                  }}
                >
                  <span
                    style={{
                      fontFamily: "monospace",
                      fontSize: 12,
                      whiteSpace: "nowrap",
                      overflow: "hidden",
                      textOverflow: "ellipsis"
                    }}
                  >
                    {sym.latex}
                  </span>
                  {sym.keywords && sym.keywords.length > 0 && (
                    <span
                      style={{
                        fontSize: 11,
                        color: "#777",
                        whiteSpace: "nowrap",
                        overflow: "hidden",
                        textOverflow: "ellipsis"
                      }}
                    >
                      {sym.keywords.slice(0, 4).join(", ")}
                    </span>
                  )}
                </div>
              </div>
            ))}

            {results.length === 0 && (
              <div
                style={{
                  padding: "4px 6px",
                  fontSize: 12,
                  color: "#888"
                }}
              >
                No matches
              </div>
            )}
          </div>
        </div>
      );
    };

    const popupRoot = ReactDOM.createRoot(
      document.getElementById("symbol-popup-root")
    );

    window.showSymbolPopup = function ({ x, y, initialQuery, onSelect }) {
      const handleSelect = (symbol) => {
        // --- Update recent list (per session, in-memory) ---
        if (!Array.isArray(window.RECENT_SYMBOLS)) {
          window.RECENT_SYMBOLS = [];
        }
        const arr = window.RECENT_SYMBOLS;
        const latex = symbol.latex;

        // Remove if already present
        const existingIndex = arr.indexOf(latex);
        if (existingIndex !== -1) {
          arr.splice(existingIndex, 1);
        }
        // Add to front
        arr.unshift(latex);
        // Keep list bounded (e.g. last 30 unique symbols)
        if (arr.length > 30) {
          arr.length = 30;
        }

        // Pass selection back to caller (inserts in textarea, etc.)
        onSelect(symbol);

        // Close popup
        popupRoot.render(null);
      };

      const handleClose = () => {
        popupRoot.render(null);
      };

      popupRoot.render(
        <SymbolPopup
          x={x}
          y={y}
          initialQuery={initialQuery}
          onSelect={handleSelect}
          onClose={handleClose}
        />
      );
    };

  </script>

  <!-- Plain JS: MathJax, copy, canvas, and backslash-triggered popup -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Load symbols.json (same pattern as Logic Level 1)
      fetch("../symbols.json")
        .then((res) => res.json())
        .then((data) => {
          window.SYMBOLS = Array.isArray(data) ? data : (data.symbols || []);
          console.log("Loaded symbols:", window.SYMBOLS.length);
        })
        .catch((err) => {
          console.error("Failed to load symbols.json", err);
          window.SYMBOLS = [];
        });

      // Render textarea contents as *block* TeX and
      // auto-wrap multi-line input in a gather* environment.
      function renderBlockTeX(textarea, outputElement) {
        const raw = textarea.value.trim();
        if (!raw) {
          outputElement.innerHTML = "";
          return;
        }

        let tex = raw;

        const explicitDisplayOrEnv = /^(\$\$|\\\[|\\begin\{)/.test(raw);
        const looksMultiline = raw.includes("\\\\") || raw.includes("\n");

        if (!explicitDisplayOrEnv) {
          if (looksMultiline) {
            tex = "\\begin{gather*}\n" + raw + "\n\\end{gather*}";
          } else {
            tex = "\\[" + raw + "\\]";
          }
        }

        outputElement.textContent = tex;

        if (window.MathJax && MathJax.typesetPromise) {
          MathJax.typesetPromise([outputElement]).catch(err => console.error(err));
        }
      }

      // Insert text into a textarea at the cursor position
      function insertAtCursor(textarea, text) {
        if (!textarea) return;
        const start = textarea.selectionStart ?? textarea.value.length;
        const end   = textarea.selectionEnd ?? textarea.value.length;
        const value = textarea.value;

        textarea.value = value.slice(0, start) + text + value.slice(end);
        const newPos = start + text.length;

        textarea.focus();
        textarea.selectionStart = textarea.selectionEnd = newPos;
        textarea.dispatchEvent(new Event("input", { bubbles: true }));
      }

      /* --------- Note board: LaTeX area ---------- */
      const noteTextarea = document.getElementById("note-latex");
      const noteRender   = document.getElementById("note-render");
      const copyNotesBtn = document.getElementById("copy-notes");

      function renderNotes() {
        renderBlockTeX(noteTextarea, noteRender);
      }

      noteTextarea.addEventListener("input", renderNotes);

      copyNotesBtn.addEventListener("click", async () => {
        const latex = noteTextarea.value.trim();
        const content = "Notes (LaTeX):\n" + latex + "\n";
        try {
          await navigator.clipboard.writeText(content);
          copyNotesBtn.classList.add("copied");
          setTimeout(() => copyNotesBtn.classList.remove("copied"), 1200);
        } catch (err) {
          console.error("Clipboard error:", err);
          alert("Copy failed – your browser may block clipboard access.");
        }
      });

      // ---------- Backslash shortcut → symbol popup (same as Level 1) ----------
      function openPopupAtTextareaCursor(ta) {
        const rect = ta.getBoundingClientRect();
        const x = rect.left + window.scrollX + 40;
        const y = rect.top + window.scrollY + 20;

        const pos = ta.selectionStart != null ? ta.selectionStart : ta.value.length;
        const value = ta.value;

        let initialQuery = "";
        const lastBackslash = value.lastIndexOf("\\", pos - 1);
        if (lastBackslash !== -1 && lastBackslash < pos) {
          initialQuery = value.slice(lastBackslash + 1, pos);
        }

        if (window.showSymbolPopup) {
          window.showSymbolPopup({
            x,
            y,
            initialQuery,
            onSelect(symbol) {
              insertAtCursor(ta, symbol.latex);
            }
          });
        }
      }

      let lastBackslashTime = 0;

      noteTextarea.addEventListener("keydown", (e) => {
        if (e.key === "\\") {
          const now = Date.now();

          if (now - lastBackslashTime < 250) {
            e.preventDefault(); // don't type this second "\"

            const pos = noteTextarea.selectionStart != null
              ? noteTextarea.selectionStart
              : noteTextarea.value.length;
            const value = noteTextarea.value;

            if (pos > 0 && value[pos - 1] === "\\") {
              noteTextarea.value = value.slice(0, pos - 1) + value.slice(pos);
              noteTextarea.selectionStart = noteTextarea.selectionEnd = pos - 1;
              noteTextarea.dispatchEvent(new Event("input", { bubbles: true }));
            }

            openPopupAtTextareaCursor(noteTextarea);
            lastBackslashTime = 0;
            return;
          }

          lastBackslashTime = now;
        }
      });

      /* --------- Note board: drawing canvas ---------- */
      const canvas = document.getElementById("note-canvas");
      const clearBtn = document.getElementById("clear-canvas");
      const ctx = canvas.getContext("2d");

      function resizeCanvas() {
        const rect = canvas.getBoundingClientRect();
        const dpr = window.devicePixelRatio || 1;

        ctx.setTransform(1, 0, 0, 1, 0, 0);

        canvas.width  = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);
        ctx.lineCap = "round";
        ctx.lineJoin = "round";
        ctx.lineWidth = 2;
      }

      resizeCanvas();
      window.addEventListener("resize", resizeCanvas);

      let drawing = false;
      let lastX = 0;
      let lastY = 0;

      function getPos(evt) {
        const rect = canvas.getBoundingClientRect();
        if (evt.touches && evt.touches[0]) {
          return {
            x: evt.touches[0].clientX - rect.left,
            y: evt.touches[0].clientY - rect.top
          };
        } else {
          return {
            x: evt.clientX - rect.left,
            y: evt.clientY - rect.top
          };
        }
      }

      function startDraw(evt) {
        evt.preventDefault();
        drawing = true;
        const pos = getPos(evt);
        lastX = pos.x;
        lastY = pos.y;
      }

      function draw(evt) {
        if (!drawing) return;
        evt.preventDefault();
        const pos = getPos(evt);
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        lastX = pos.x;
        lastY = pos.y;
      }

      function endDraw(evt) {
        if (!drawing) return;
        evt.preventDefault();
        drawing = false;
      }

      canvas.addEventListener("mousedown", startDraw);
      canvas.addEventListener("mousemove", draw);
      window.addEventListener("mouseup", endDraw);

      canvas.addEventListener("touchstart", startDraw, {passive: false});
      canvas.addEventListener("touchmove", draw, {passive: false});
      canvas.addEventListener("touchend", endDraw, {passive: false});
      canvas.addEventListener("touchcancel", endDraw, {passive: false});

      clearBtn.addEventListener("click", () => {
        const rect = canvas.getBoundingClientRect();
        ctx.clearRect(0, 0, rect.width, rect.height);
      });
    });
  </script>
</body>
</html>
